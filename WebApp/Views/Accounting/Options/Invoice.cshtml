<!-- Modal billimg-->
<div class="modal fade modal-xl" id="modalInvoice" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabelBilling" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content" style="border: 1px solid #bcbcbc">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabelBilling">Invoice Detail</h5>
                <button type="button" class="btn-close" onclick="closeModalInvoice()"></button>
            </div>
            <div class="modal-body">
                @* <div class="mb-2">
                    <button class="mui-button mui-button-search" >Post</button>
                </div> *@
                <div class="functions-pane mb-2" style="background-color: var(--accent-color);border-radius: 8px; border: 1px solid #e5e7eb;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);padding:0px">
                    <div class="function-menu">
                        <a href="#" onclick="openModalTransfer();">Transfer</a>
                        <a href="#" onclick="openModalPosting();">Post</a>
                        <a href="#" onclick="adjustTransaction();">Adjust</a>

                    </div>
                </div>
                <div class="mb-2">
                    <div class="mui-card">
                        <div class="header" style="justify-content:space-between">
                            <div class="header2">
                                <i class="fa-solid fa-sliders" style="background-color:#2b6cb0;color:white;padding:4px"></i>

                                <h3 id="content-title">
                                    Filter

                                </h3>

                            </div>

                            <div class="header2">
                                <i class="fa-solid fa-magnifying-glass" onclick="searchMaintenance()"></i>

                            </div>
                        </div>

                        <div id="filter" class="tab-pane ">
                            <div class="row">




                                <div class="form-group-new-reservation col-md-1">
                                    <label>Account Name</label>
                                    <input type="text" id="accountNameInvoice">

                                </div>
                                <div class="form-group-new-reservation col-md-1">
                                    <label>Account No</label>
                                    <input type="text" id="accountNoInvoice">

                                </div>
                                <div class="form-group-new-reservation col-md-1">
                                    <label>Name</label>
                                    <input type="text" id="nameInvoice">

                                </div>
                                <div class="form-group-new-reservation col-md-1">
                                    <label>Confirmation No</label>
                                    <input type="text" id="confirmationNoInvoice">

                                </div>
                                <div class="form-group-new-reservation col-md-1">
                                    <label>Folio No</label>
                                    <input type="text" id="folioNoInvoice">

                                </div>
                                <div class="form-group-new-reservation col-md-1">
                                    <label>Arrival</label>
                                    <input type="text" id="arrivalInvoice">

                                </div>
                                <div class="form-group-new-reservation col-md-1">
                                    <label>Departure</label>
                                    <input type="text" id="departureInvoice">

                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div id="gridContainerInvoice" class="gridContainer mt-2"></div>

            </div>
        </div>
    </div>
</div>
@await Html.PartialAsync("Options/Transfer")
@await Html.PartialAsync("Options/Posting")
@await Html.PartialAsync("Options/Adjust")

<script>
    function openModalInvoice() {
        const today = new Date().toISOString().split('T')[0];

        // Set default values for From Date and To Date
        $('#fromDateMaintenance').val(today);
        $('#toDateMaintenance').val(today);
        getInfoInvoice();
        searchInvoice();
        $('#modalInvoice').modal('show');
    }
    function closeModalInvoice(){
        $('#modalInvoice').modal('hide');
    }
    function getInfoInvoice() {
        var grid = $("#gridContainer").dxDataGrid("instance");
        var selectedRows = grid.getSelectedRowsData();
        var selectedIds = selectedRows.map(row => row.ID);
        var grid2 = $("#gridContainerMaintenance").dxDataGrid("instance");
        var selectedRows2 = grid2.getSelectedRowsData();
        var selectedIds2 = selectedRows2.map(row => row.FolioID);
        $.ajax({
            url: '/Accounting/SearchInfoInvoice',
            type: 'get',
            dataType: 'json',
            data: {
                arID: selectedIds[0],
                folioID: selectedIds2[0]
            },
            crossDomain: false,
            headers: { "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val() },
            success: function (result) {
                if (result.code == 1) {
                    showToast("Error", result.msg, false)
                }
                else {


                    $('#accountNameInvoice').val(result.result3[0].AccountName);
                    $('#accountNoInvoice').val(result.result3[0].AccountNo);
                    $('#nameInvoice').val(result.result1[0].AccountName);
                    $('#confirmationNoInvoice').val(result.result1[0].ConfirmationNo);
                    $('#folioNoInvoice').val(selectedIds2[0]);
                    $('#arrivalInvoice').val(result.result2[0].ArrivalDate);
                    $('#departureInvoice').val(result.result2[0].DepartureDate);
                }

                // initializeDataGridMaintenance(result);
            },
            error: function (xhr, statusText, err) {
                if (xhr.status == 401) {
                    sessionTimeout();
                }
            },

        });

    }
     function searchInvoice() {
         var grid = $("#gridContainerMaintenance").dxDataGrid("instance");
         var selectedRows = grid.getSelectedRowsData();
         var selectedIds = selectedRows.map(row => row.FolioID);
         $.ajax({
             url: '/Accounting/InvoiceSearch',
             type: 'get',
             dataType: 'json',
             data: {
                 folioID: selectedIds[0],

             },
             crossDomain: false,
             headers: { "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val() },
             success: function (result) {
                 initializeDataGridInvoice(result.result1);
             },
             error: function (xhr, statusText, err) {
                 if (xhr.status == 401) {
                     sessionTimeout();
                 }
             },

         });

     }
    function initializeDataGridInvoice(data) {

        $("#gridContainerInvoice").dxDataGrid({
            dataSource: data,
            allowColumnResizing: true,

            paging: { pageSize: 15 },
            scrolling: {
                rowRenderingMode: 'virtual'
            },
            pager: {
                visible: true,
                allowedPageSizes: [15, 20, 'all'],
                showPageSizeSelector: true,
                showInfo: true,
                showNavigationButtons: true
            },
            filterRow: {
                visible: true,
                applyFilter: "auto"
            },
            selection: {
                mode: "multiple",
                showCheckBoxesMode: "always"
            },
            onRowClick: function (e) {
                const grid = $("#gridContainerInvoice").dxDataGrid("instance");
                grid.selectRows([e.key], false);
            },
        });
     }
</script>