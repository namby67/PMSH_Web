<div class="text-center" id="reportTitle" style="font-size: 20px">Routing Code</div>
<div class="sticky-header bg-white p-2 shadow-sm z-3">
    <div class="">
        <button style="border-radius: 4px;  margin-right: 6px;" id="btnView" onclick="openModalSearchUser()"
            class="mui-button mui-button-search"><i class="fa-solid fa-search"></i>Search</button>
        <button style="border-radius: 4px;  margin-right: 6px;" id="btnNew" class="mui-button mui-button-new"
            type="button"><i class="fa-solid fa-plus"></i> New</button>
        <button style="border-radius: 4px;  margin-right: 6px;" id="btnEdit" class="mui-button mui-button-edit "
            type="button"><i class="fa-solid fa-pen"></i> Edit</button>
        <button style="border-radius: 4px;  margin-right: 6px;" id="btnSave" class="mui-button mui-button-export "
            type="button"> <i class="fa-solid fa-floppy-disk"></i> Save</button>
        <button style="border-radius: 4px;  margin-right: 6px;" id="btnDelete" class="mui-button button-report-delete"
            type="button"> <i class="fa-solid fa-trash-can"></i> Delete</button>
    </div>
</div>
<div class="mui-card">
    <div class="row align-items-start">
        <div class="col-md-3 border border-2  p-3">
            <div class="col-12">
                <label class="form-label me-2 mb-0">Code</label>
                <input id="code" class="form-control mb-2 " name="code" />
                <div class="invalid-feedback"></div>
            </div>
            <div class="col-12">
                <label class="form-label me-2 mb-0 ">Description</label>
                <input type="text" class="form-control mb-2 " name="description" id="description">
                <div class="invalid-feedback"></div>
            </div>
            <div class="col-12">
                <label
                    class="form-label me-2 mb-0                                                                                                                                                                                                        ">Calculation
                    Rule</label>
                <select class="form-control form-select form-control-sm" name="calculationRuleID" id="calculationRuleID"
                    mb-2>
                    <option value="0">-- Calculation Rule --</option>
                    <option value="1">Per Person</option>
                    <option value="2">Per Adult</option>
                    <option value="3">Per Child</option>
                    <option value="4">Per Room</option>
                    <option value="5">Per Child1</option>
                    <option value="6">Per Child2</option>
                    <option value="7">Per Child3</option>
                    <option value="8">Per Adutl + C</option>
                    <option value="9">Per Adutl + C + C1</option>
                    <option value="10">Per Adutl + C1</option>
                    <option value="11">Per C + C1</option>
                </select>
                <div class="invalid-feedback"></div>
            </div>

        </div>
        <!-- RIGHT TABLE -->
        <div class="col-md-9">
            <div id="routingCodeGrid" class="gridContainer"></div>
        </div>
    </div>
</div>
<script>
    $(document).ready(async function () {
        await GetAllRoutingCode();
    });
    async function GetAllRoutingCode() {
        const resRoutingCode = await $.ajax({
            url: "/Administration/RoutingCode/GetAllRoutingCode",
            method: "GET"
        });
        if (!resRoutingCode?.success) {
            showToast('Error', resRoutingCode?.message || 'Failed to load Routing Code.', false);
            initializeRoutingCodeGrid([]);;
        }
        const resData = resRoutingCode.data;
        initializeRoutingCodeGrid(resData);

    }
    async function initializeRoutingCodeGrid(dataPackageDetailGrid) {
        $("#routingCodeGrid").dxDataGrid({
            dataSource: dataPackageDetailGrid || [],
            showBorders: true,
            selection: { mode: "single" },
            paging: { pageSize: 20 },
            height: "calc(100vh - 360px)",
            width: "100%",
            pager: {
                showPageSizeSelector: true,
                allowedPageSizes: [20, 50, 100],
                showInfo: true
            },
            filterRow: { visible: true },
            columns: [
                { dataField: "id", caption: "ID", visible: false },
                { dataField: "code", caption: "Code", width: "10%" },
                { dataField: "description", caption: "Description", dataType: "string", width: "30%" },
                { dataField: "transactionCodes", caption: "Transsaction Code", width: "60%" },


            ],
            scrolling: {
                mode: "standard", // Kh√¥ng d√πng virtual ƒë·ªÉ footer hi·ªÉn th·ªã ƒë√∫ng
                showScrollbar: "always",
                scrollByContent: true
            },
            filterRow: {
                visible: true,
                applyFilter: "auto"
            },
            // üî• Quan tr·ªçng: g√°n selectedRowData khi click ch·ªçn
            onRowClick: function (e) {
                selectedRowData = e.data; // üî• l·∫•y data c·ªßa row v·ª´a click
                console.log("Selected Row (RowClick):", selectedRowData);
                selectPackageDetail(selectedRowData);
            },
            noDataText: "No records to display" // hi·ªÉn th·ªã text khi ch∆∞a c√≥ d·ªØ li·ªáu
        });
    }
</script>
