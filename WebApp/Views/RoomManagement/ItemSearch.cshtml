@using DevExpress.XtraReports.UI
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    var selectedReport = @ViewBag.ReportHeader;
    var trans = ViewBag.TransactionsList;
    var dpm = ViewBag.DepartmentList;
    var userInsertID = Context.Session.GetInt32("UserID") ?? 0;
}


<style>
    #gridContainer .dx-datagrid-rowsview .dx-selection {
        background-color: #005f87 !important; /* màu xanh ng?c */
        color: white !important; /* ch? tr?ng */
    }

        #gridContainer .dx-datagrid-rowsview .dx-selection * {
            color: white !important;
        }

    .dx-datagrid-headers .dx-header-row td {
        white-space: pre-line !important;
        text-align: center;
        font-size: 11px;
    }


    .dx-datagrid .dx-editor-with-menu .dx-menu-item-content .dx-icon.dx-icon-filter-operation-default, .dx-datagrid-container .dx-editor-with-menu .dx-menu-item-content .dx-icon.dx-icon-filter-operation-default {
        display: none;
    }

    #gridContainer .dx-datagrid-rowsview .dx-row > td {
        padding-top: 2px !important;
        padding-bottom: 2px !important;
        font-size: 12px !important;
        line-height: 24px !important;
    }

    #gridContainer .dx-datagrid-headers {
        background-color: #3b9ac6 !important; /* Màu xanh duong */
        color: white !important; /* Ch? tr?ng cho d? d?c */
    }

        #gridContainer .dx-datagrid-headers .dx-header-row > td {
            padding-top: 12px !important;
            padding-bottom: 12px !important;
            font-size: 12px !important;
        }

        #gridContainer .dx-datagrid-headers .dx-header-row > td {
            background-color: #3b9ac6 !important;
            color: white !important;
            font-weight: bold;
            border-right: 1px solid #ddd !important;
            text-align: center !important;
        }

        #gridContainer .dx-datagrid-rowsview td,
        #gridContainer .dx-datagrid-headers td {
            border-right: 1px solid #ddd !important;
        }

        /* Lo?i b? vi?n ph?i ? c?t cu?i cùng (tùy ch?n) */
        #gridContainer .dx-datagrid-rowsview tr td:last-child,
        #gridContainer .dx-datagrid-headers tr td:last-child {
            border-right: none !important;
        }

    #gridContainer .dx-datagrid-rowsview .dx-selection {
        background-color: #01579b !important;
        color: white !important;
    }

        #gridContainer .dx-datagrid-rowsview .dx-selection * {
            color: white !important;
        }

    #gridContainer .dx-datagrid-filter-row td .dx-datebox {
        height: 24px !important;
        min-height: 24px !important;
    }

        #gridContainer .dx-datagrid-filter-row td .dx-datebox input {
            font-size: 12px !important;
            height: 24px !important;
        }

    #gridContainer .dx-datagrid-filter-row td .dx-editor-with-menu,
    #gridContainer .dx-datagrid-filter-row td .dx-texteditor input {
        height: 24px !important;
        line-height: 24px !important;
        padding: 2px 6px !important;
        font-size: 12px !important;
        box-sizing: border-box;
    }

    #gridContainer .dx-datagrid-filter-row td .dx-datebox,
    #gridContainer .dx-datagrid-filter-row td .dx-dropdowneditor {
        height: 26px !important;
        min-height: 26px !important;
        font-size: 12px !important;
    }

    #logGridContainer .dx-datagrid-rowsview .dx-selection {
        background-color: #005f87 !important; /* màu xanh ng?c */
        color: white !important; /* ch? tr?ng */
    }

        #logGridContainer .dx-datagrid-rowsview .dx-selection * {
            color: white !important;
        }

    #logGridContainer .dx-datagrid-rowsview .dx-row > td {
        padding-top: 2px !important;
        padding-bottom: 2px !important;
        font-size: 12px !important;
        line-height: 24px !important;
    }

    #logGridContainer .dx-datagrid-headers {
        background-color: #3b9ac6 !important; /* Màu xanh duong */
        color: white !important; /* Ch? tr?ng cho d? d?c */
    }

        #logGridContainer .dx-datagrid-headers .dx-header-row > td {
            padding-top: 12px !important;
            padding-bottom: 12px !important;
            font-size: 12px !important;
            background-color: #3b9ac6 !important;
            color: white !important;
            font-weight: bold;
            border-right: 1px solid #ddd !important;
            text-align: center !important;
        }

        #logGridContainer .dx-datagrid-rowsview td,
        #logGridContainer .dx-datagrid-headers td {
            border-right: 1px solid #ddd !important;
        }

        /* Lo?i b? vi?n ph?i ? c?t cu?i cùng (tùy ch?n) */
        #logGridContainer .dx-datagrid-rowsview tr td:last-child,
        #logGridContainer .dx-datagrid-headers tr td:last-child {
            border-right: none !important;
        }

    #logGridContainer .dx-datagrid-rowsview .dx-selection {
        background-color: #01579b !important;
        color: white !important;
    }

    #logGrid
    .dx-datagrid-rowsview .dx-selection * {
        color: white !important;
    }

    #logGridContainer .dx-datagrid-filter-row td .dx-datebox {
        height: 24px !important;
        min-height: 24px !important;
    }

        #logGridContainer .dx-datagrid-filter-row td .dx-datebox input {
            font-size: 12px !important;
            height: 24px !important;
        }

    #logGridContainer .dx-datagrid-filter-row td .dx-editor-with-menu,
    #logGridContainer .dx-datagrid-filter-row td .dx-texteditor input {
        height: 24px !important;
        line-height: 24px !important;
        padding: 2px 6px !important;
        font-size: 12px !important;
        box-sizing: border-box;
    }

    #logGridContainer .dx-datagrid-filter-row td .dx-datebox,
    #logGridContainer .dx-datagrid-filter-row td .dx-dropdowneditor {
        height: 26px !important;
        min-height: 26px !important;
        font-size: 12px !important;
    }

    .filter_wrapper {
        /*     background-color: #ececec; */
        /*   margin: 0px 8px 14px 8px; */
        padding: 18px 0px 0px 14px;
        border-radius: 8px;
    }

    .gridContainer {
        margin: 0px 8px;
    }

    .button_wrapper {
        display: flex;
        column-gap: 12px;
        margin: 0px 8px;
    }

        .button_wrapper .fa-solid {
            margin-right: 5px;
        }

    .selected {
        background-color: #4CAF50; /* Màu xanh */
        color: white;
    }

    #gridContainer .dx-datagrid-rowsview .dx-selection {
        background-color: #01579b !important; /* màu xanh ng?c */
        color: white !important; /* ch? tr?ng */
    }

        #gridContainer .dx-datagrid-rowsview .dx-selection * {
            color: white !important;
        }

    .sticky-header .form-control-sm {
        padding: .1rem .35rem;
        height: calc(1.1em + .2rem + 2px);
    }

    .sticky-header label[class*="me-"] {
        margin-right: .5rem !important;
    }

    #gridContainer .dx-datagrid-headers .dx-header-row > td {
        padding: 5px !important;
        height: 24px !important;
        font-size: 12px !important;
        line-height: 1.1 !important;
    }

    .sticky-header input[type="date"].form-control-sm {
        font-size: 12px !important; /* dúng 12?px */
        height: calc(1.1em + .2rem + 2px); /* gi? cùng chi?u cao */
    }

    .sticky-header label {
        font-size: 12px !important;
        line-height: 1.2;
    }


    .sort-select {
        max-width: 130px; /* ho?c 100px n?u mu?n nh? hon */
        font-size: 12px;
        padding: 0.15rem 0.5rem;
    }

    .sort-select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: none !important;
        padding-right: 10px !important;
    }

    button:disabled {
        pointer-events: none; /* Không cho hover/click */
        opacity: 0.6; /* Cho nó mờ đi */
        cursor: not-allowed; /* Hiện con trỏ cấm */
        background-color: #ccc !important; /* tuỳ chỉnh màu khi disable */
    }

    .tomselect-custom {
        width: 100px;
        min-height: 30px; /* hoặc tùy theo chiều cao bạn muốn */
        font-size: 12px !important;
    
    }

        .tomselect-custom .ts-control {
            padding-left: 8px !important; /* hoặc bất kỳ giá trị nào bạn muốn */
        }

    #groupCode.form-control-sm,
    #subGroupCode.form-control-sm {
        height: 26px !important; /* chiều cao nhỏ */
        font-size: 12px !important; /* chữ nhỏ */
        padding: 2px 6px !important; /* padding nhỏ */
        line-height: 1.2 !important; /* căn giữa chữ */
        max-width: 180px; /* chiều rộng vừa phải */
    }

    .hide-band .dx-datagrid-bands > tr:first-child {
        display: none !important;
    }

    .shift-header {
        background: #f2f2f2;
        padding: 8px 12px;
        border-bottom: 1px solid #ccc;
        font-size: 13px;
    }

        .shift-header .row {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 4px;
        }

            .shift-header .row div {
                flex: 1; /* chia đều các cột */
                min-width: 150px; /* giữ cho không quá hẹp */
            }

        .shift-header i {
            font-style: italic;
            color: #333;
        }

        .shift-header b {
            font-weight: bold;
            margin-left: 4px;
        }

    .dx-popup-title {
        text-align: center !important;
        width: 100%;
    }

    /* Áp dụng cho tất cả text trong grid popup */
    #popupShiftDetail .dx-datagrid {
        font-size: 12px !important;
    }

        /* Nếu vẫn không ăn, target chi tiết hơn */
        #popupShiftDetail .dx-datagrid .dx-row > td,
        #popupShiftDetail .dx-datagrid .dx-header-row > td {
            font-size: 12px !important;
        }

    #fromCurrency {
        font-size: 12px; /* nhỏ chữ */
        padding: 2px 6px; /* thu gọn khoảng cách */
        height: auto; /* tránh Bootstrap ép chiều cao */
    }

    #toCurrency {
        font-size: 12px; /* nhỏ chữ */
        padding: 2px 6px; /* thu gọn khoảng cách */
        height: auto; /* tránh Bootstrap ép chiều cao */
    }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Ẩn mũi tên trong Firefox */
    input[type=number] {
        -moz-appearance: textfield;
        text-align: right;
    }

    #gridExchangeRate .dx-datagrid-headers td,
    #gridExchangeRate .dx-datagrid-rowsview td,
    #gridExchangeRate .dx-datagrid-filter-row td {
        font-size: 12px !important;
        padding: 2px 4px !important;
        line-height: 1.2 !important;
    }

    .custom-modal-width {
        max-width: 1000px; /* hoặc 1100px, tùy ý */
    }

    .modal.show {
        overflow-y: auto !important;
    }

    .ts-dropdown {
        max-height: 400px !important; /* Tăng lên bao nhiêu tùy ý, miễn không tràn màn hình */
        overflow-y: auto !important;
        overflow-x: hidden !important;
        z-index: 9999 !important;
    }

    .swal-small {
        width: 300px !important; /* thu nhỏ chiều rộng */
        font-size: 14px !important; /* giảm cỡ chữ */
        padding: 15px !important; /* giảm padding */
    }

    .swal2-title {
        font-size: 16px !important;
    }

    .swal2-html-container {
        font-size: 14px !important;
    }

    .swal2-confirm, .swal2-cancel {
        font-size: 13px !important;
        padding: 4px 10px !important;
    }
</style>
<link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
<!-- SweetAlert2 CSS & JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="text-center" id="reportTitle" style="font-size: 20px">Item List</div>
<div class="sticky-header bg-white p-2 shadow-sm z-3">
    <div class="d-flex flex-wrap align-items-center gap-2 mb-1" style="border: 1px solid #ced4da; border-radius: 6px; padding: 8px;">
        <div class="d-flex align-items-center me-3">
            <label class="me-2 mb-0">Item Group:</label>
            <select id="itemGroup" name="itemGroup" class="form-control form-control-sm w-auto">
                <option value="0">--All--</option>
                <option value="1">Recreational</option>
                <option value="2">Audiovisual</option>
                <option value="3">Cocktail</option>
                <option value="4">Decoration</option>
                <option value="5">Room</option>
            </select>
        </div>
        <div class="d-flex align-items-center me-2">
            <label class="me-2 mb-0">Item Name:</label>
            <input style="width: 80px;" type="text" id="itemName" name="itemName" class="form-control form-control-sm " />
        </div>
        
    </div>
    <div class="">
        <button style="border-radius: 4px;  margin-right: 6px;background-color: #6c757d;" id="btnView" class="mui-button mui-button-new"><i class="fa-solid fa-eye"></i> View</button>
        <button style="border-radius: 4px;  margin-right: 6px;background-color: #28a745;" id="btnNew" class="mui-button mui-button-new" type="button"> <i class="fa-solid fa-file-excel"></i> New</button>
        <button style="border-radius: 4px;  margin-right: 6px;background-color: #007bff;" id="btnEdit" class="mui-button mui-button-new"><i class="fa-solid fa-eye"></i> Edit</button>
        <button style="border-radius: 4px;  margin-right: 6px;background-color: #dc3545;" id="btnDelete" class="mui-button mui-button-new"><i class="fa-solid fa-eye"></i> Delete</button>
    </div>
</div>

<div class="mui-card">

    <div id="gridWrapper" class="mt-2" style="max-height: 500px;">
        <div id="gridContainer"></div>
    </div>
</div>
<!-- Modal Popup for New Item -->
<div class="modal fade" id="itemModal" tabindex="-1" aria-labelledby="itemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl custom-modal-width">
        <!-- modal-lg để form rộng hơn -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="itemModalLabel">New Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
             
                <form id="itemForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div style="border: 1px solid #ced4da; border-radius: 6px; padding: 8px;">
                                <div class="">
                                    <label class="">Transaction Code:</label>
                                    <select id="transactionCode" class="tomselect-custom" style="width: 457px;" multiple>
                         
                                        @foreach (var tr in ViewBag.TransactionsList)
                                        {
                                            <option value="@tr.Code">@tr.Code - @tr.Description</option>
                                        }
                                    </select>
                                </div>
                            <label>Group</label>
                                <select id="groupId" name="group" class="form-select mb-2">
                                    <option>--Chose One--</option>
                                    <option value="1">Recreational</option>
                                    <option value="2">Audiovisual</option>
                                    <option value="3">Cocktail</option>
                                    <option value="4">Decoration</option>
                                    <option value="5">Room</option>
                            </select>
                            <label>Code</label>
                            <input type="text" id="code" class="form-control mb-2" />
                            <label>Name</label>
                            <input type="text" id="name" class="form-control mb-2" />
                            <label>Description</label>
                            <textarea id="description" class="form-control mb-2"></textarea>
                                <div class="">
                                    <label class="">Department:</label>
                                    <select id="department" class="form-control form-control-sm" style="width: 457px;">
                                        <option value="">---Select Department---</option>
                                        @foreach (var dpm in ViewBag.DepartmentList)
                                        {
                                            <option value="@dpm.ID">@dpm.Code - @dpm.Name</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 ">
                            <div style="border: 1px solid #ced4da; border-radius: 6px; padding: 8px;">
                            <label>Quantity in Stock</label>
                            <input id="qins" type="number" class="form-control mb-2" />
                            <label>Default Quantity</label>
                            <input id="default" type="number" class="form-control mb-2" />
                            <label>Available From</label>                           
                                <input id="availableFrom" type="text" class="form-control mb-2" />
                            <label>Available To</label>                            
                                <input id="availableTo" type="text" class="form-control mb-2" />
                            <label>Setup Time</label>
                            <input id="setupTime"type="text" class="form-control mb-2" />
                            <label>Setdown Time</label>
                            <input id="setdownTime" type="text" class="form-control mb-2" />
                            </div>
                        </div>
                    </div>
                    <label>Trace Text</label>
                    <textarea id="traceText" class="form-control mt-2"></textarea>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" id="btnSaveItem" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</div>

<div id="loadingSpinner" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:1000;">
    <i class="fa-solid fa-spinner fa-spin"></i>
</div>
<script>
    const departmentList = @Html.Raw(Json.Serialize(ViewBag.DepartmentList));
    console.log("Department List:", departmentList);
    const userInsertID = @userInsertID;
    let selectedRowData = null;
    DevExpress.localization.locale("vi");
      function formatDate(date) {
            let year = date.getFullYear();
            let month = (date.getMonth() + 1).toString().padStart(2, '0'); // Đảm bảo có 2 chữ số
            let day = date.getDate().toString().padStart(2, '0'); // Đảm bảo có 2 chữ số
            return `${year}-${month}-${day}`;
        }
      $(document).ready(function () {
          
                reloadGrid();
                initializeTomSelects();
        });

        function initializeTomSelects() {
                const selectors = ["#transactionCode"];

            for (const id of selectors) {
                const el = document.querySelector(id);
                if (!el) continue;

                if (el.tomselect) el.tomselect.destroy();

                const ts = new TomSelect(el, {
                    plugins: ['remove_button'],
                    create: false,
                    maxItems: null,
                    allowEmptyOption: true,
                    placeholder: '',
                    persist: false,
                    maxOptions: 1000,
                    render: {
                        option: function (data, escape) {
                            return `<div>${escape(data.text)}</div>`;
                        }
                    }
                });

            }
        }
    $(document).off("click", "#btnView").on("click", "#btnView", function () {
         reloadGrid();
    });

    function loadTelephoneGrid(data) {
            $("#gridContainer").dxDataGrid({
            dataSource: data,
            width: "100%",
            columnAutoWidth: false,
            allowColumnResizing: true,
            columnResizingMode: "widget",
            selection: { mode: "single" },
            columns: [
                { dataField: "group", caption: "Group", width: "7%" },
                { dataField: "code", caption: "Code", width: "7%" },
                { dataField: "name", caption: "Name", width: "8%" },
                { dataField: "description", caption: "Description", width: "15%" },
                { dataField: "transactionCode", caption: "Transaction Code", width: "12%" },
                { dataField: "department", caption: "Department", width: "8%" },
                { dataField: "qinStock", caption: "Q in Stock", width: "6%" },
                { dataField: "defaultQ", caption: "Default", width: "6%" },
                { dataField: "setupTime", caption: "Setup Time", width: "7%" },
                { dataField: "setdownTime", caption: "Setdown Time", width: "7%" },
                { dataField: "availFrom", caption: "Avail From", dataType: "date", format: "dd/MM/yyyy", width: "8%" },
                { dataField: "availTo", caption: "Avail To", dataType: "date", format: "dd/MM/yyyy", width: "8%" },
                { dataField: "traces", caption: "Traces", width: "5%" }
   
            ],
            scrolling: {
                    mode: "standard", // Không dùng virtual để footer hiển thị đúng
                    showScrollbar: "always",
                    scrollByContent: true
                },
                paging: {
                    pageSize: 20
                },
                pager: {
                    visible: true,
                    allowedPageSizes: [20, 50, 'all'],
                    showPageSizeSelector: true,
                    showInfo: true,
                    showNavigationButtons: true
                },
                    filterRow: {
                visible: true,
                applyFilter: "auto"
            },
            // 🔥 Quan trọng: gán selectedRowData khi click chọn
            onSelectionChanged: function (e) {
                if (e.selectedRowsData.length > 0) {
                    selectedRowData = e.selectedRowsData[0]; // gán row đang chọn
                    console.log("Selected Row:", selectedRowData);
                } else {
                    selectedRowData = null;
               
                }
            }
        });
        }

            function getGroupIdByName(name) {
        const groupMap = {
            "Recreational": 1,
            "Audiovisual": 2,
            "Cocktail": 3,
            "Decoration": 4,
            "Room": 5
        };

        return groupMap[name] || 0;
    }
                   function findDepartmentId(value) {
        if (!value || !Array.isArray(departmentList)) return 0;

        const valLower = value.toString().toLowerCase();

        // So sánh với code
        const byCode = departmentList.find(d =>
            d?.code?.toLowerCase() === valLower
        );
        if (byCode) return byCode.id;

        // So sánh với name
        const byName = departmentList.find(d =>
            d?.name?.toLowerCase() === valLower
        );
        if (byName) return byName.id;

        // Nếu nhập số ID thô
        const idValue = parseInt(value);
        if (!isNaN(idValue)) {
            const byId = departmentList.find(d => d?.id === idValue);
            if (byId) return byId.id;
        }

        return 0;
    }


   
         $("#btnNew").click(function () {  
          $("#itemForm")[0].reset();
          $('#transactionCode')[0].tomselect.clear();
          $("#itemModal").modal("show");
    });
        $(document).off("click", "#btnEdit").on("click", "#btnEdit", function () {
        if (!selectedRowData) {
            alert("Vui lòng chọn một dòng để chỉnh sửa.");
            return;
        }
        $('#code').val(selectedRowData.code);
        $('#name').val(selectedRowData.name);
        $('#description').val(selectedRowData.description);

        // transactionCode (là multiple select TomSelect)
        const transactionSelect = $('#transactionCode')[0].tomselect;
        if (transactionSelect) {
            transactionSelect.clear(); // xoá tất cả option đang chọn
            if (selectedRowData.transactionCode) {
                const codes = selectedRowData.transactionCode.split(",");
                transactionSelect.setValue(codes);
            }
        }

        $('#groupId').val(getGroupIdByName(selectedRowData.group));
        $('#department').val(findDepartmentId(selectedRowData.department)).trigger('change');
        $('#qins').val(selectedRowData.qinStock);
        $('#default').val(selectedRowData.defaultQ);
        $('#availableFrom').val(selectedRowData.availFrom?.split("T")[0]); // ISO format
        $('#availableTo').val(selectedRowData.availTo?.split("T")[0]);
        $('#setupTime').val(selectedRowData.setupTime);
        $('#setdownTime').val(selectedRowData.setdownTime);
        $('#traceText').val(selectedRowData.traces);

        // Hiển thị modal
        $('#itemModal').modal("show");
    });


    $('#btnSaveItem').click(function() {
        var data = {
            id: selectedRowData?.id || 0,
            code: $('#code').val(),
            name: $('#name').val(),
            description: $('#description').val(),
            transactionCode: $('#transactionCode').val().join(','), // vì multiple select
            articleCode: '', // nếu có input thì lấy giá trị tương tự
            cost: '',
            rateCodeID: 0,
            rateAmount: 0,
            itemGroupID: parseInt($('#groupId').val()) || 0,
            departmentID:  parseInt($('#department').val()),
            quantityStock: parseInt($('#qins').val()),
            quantityDefault: parseInt($('#default').val()),
            setupTime: $('#setupTime').val(),
            setDownTime: $('#setdownTime').val(),
            availableFrom: $('#availableFrom').val(),
            availableTo: $('#availableTo').val(),
            traces: $('#traceText').val(),
            attribute: '',
            createDate: new Date().toISOString(),
            updateDate: new Date().toISOString(),
            userInsertID: userInsertID, // hoặc lấy từ session/user context
            userUpdateID: userInsertID
        };
           console.log("Sending data:", data);
           console.log("Code field: ", $('#code').val());
        // Kiểm tra ID có tồn tại không => insert hay update
        const isEdit = selectedRowData && selectedRowData.id > 0;
        const url = isEdit ? '/RoomManagement/UpdateItem' : '/RoomManagement/InsertItem';

        $.ajax({
            url: url,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function (response) {
                showToast('Success', (isEdit ? 'Update' : 'Insert') + ' successfully!', true);
                $('#itemModal').modal('hide');
                selectedRowData = null;
                reloadGrid();
            },
            error: function (xhr) {
                console.error('Ajax error', {
                    status: xhr.status,
                    responseText: xhr.responseText
                });
                showToast('Error', (isEdit ? 'Error update: ' : 'Error insert: ') + xhr.status + ' – ' + xhr.responseText, false);
            }
        });
    });

        $("#btnDelete").click(function () {
        if (!selectedRowData) {
            DevExpress.ui.notify("Please select a row first!", "warning", 2000);
            return;
        }

                Swal.fire({
            title: 'Are you sure?',
            text: "This action cannot be undone.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'Cancel',
            customClass: {
                popup: 'swal-small'
            }
        }).then((result) => {
            if (result.isConfirmed) {
                deleteSelectedItem();
            }
        });

    });
    function deleteSelectedItem() {
        $.post("/RoomManagement/DeleteItem", { id: selectedRowData.id }, function (res) {
            if (res.deleted > 0) {
                showToast("Success", "Deleted successfully!", true);
                reloadGrid();
                $("#itemForm")[0].reset();
                selectedRowData = null;
            } else {
                showToast("Error", "Delete failed!", false);
            }
        }).fail(function (xhr) {
            console.error("Delete error:", xhr.responseText);
            showToast("Error", "Delete error!", false);
        });
    }

        function reloadGrid() {
        $("#loadingSpinner").show();
        $.ajax({
            url: '/RoomManagement/GetItemSearch',
            type: 'GET',
            data: {
                groupID: $("#itemGroup").val(),
                name: $("#itemName").val(),
            },
            success: function (data) {
                // load lại grid với data mới
                loadTelephoneGrid(data);
                $("#loadingSpinner").hide();
            },
            error: function (xhr, status, error) {
                alert("Không thể tải dữ liệu");
                $("#loadingSpinner").hide();
            }
        });
    }


</script>