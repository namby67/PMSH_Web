@using DevExpress.XtraReports.UI
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewBag.Title = ViewBag.ReportHeader;
    var zoneList = ViewBag.ZoneList;
    var roomtypeList = ViewBag.RoomTypeList;
}

@* <link asp-append-version="true" href="~/css/reservation.css" rel="stylesheet" /> *@
<style>
   /*  #logGridContainer .dx-datagrid-rowsview .dx-selection {
        background-color: #005f87 !important; 
        color: white !important; 
    }

        #logGridContainer .dx-datagrid-rowsview .dx-selection * {
            color: white !important;
        }

    #logGridContainer .dx-datagrid-rowsview .dx-row > td {
        padding-top: 2px !important;
        padding-bottom: 2px !important;
        font-size: 12px !important;
        line-height: 24px !important;
    }

    #logGridContainer .dx-datagrid-headers {
        background-color: #3b9ac6 !important; 
        color: white !important; 
    }

        #logGridContainer .dx-datagrid-headers .dx-header-row > td {
            padding-top: 12px !important;
            padding-bottom: 12px !important;
            font-size: 12px !important;
            background-color: #3b9ac6 !important;
            color: white !important;
            font-weight: bold;
            border-right: 1px solid #ddd !important;
            text-align: center !important;
        }

        #logGridContainer .dx-datagrid-rowsview td,
        #logGridContainer .dx-datagrid-headers td {
            border-right: 1px solid #ddd !important;
        }

        
        #logGridContainer .dx-datagrid-rowsview tr td:last-child,
        #logGridContainer .dx-datagrid-headers tr td:last-child {
            border-right: none !important;
        }

    #logGridContainer .dx-datagrid-rowsview .dx-selection {
        background-color: #01579b !important;
        color: white !important;
    }

        #logGridContainer .dx-datagrid-rowsview .dx-selection * {
            color: white !important;
        }

    #logGridContainer .dx-datagrid-filter-row td .dx-datebox {
        height: 24px !important;
        min-height: 24px !important;
    }

        #logGridContainer .dx-datagrid-filter-row td .dx-datebox input {
            font-size: 12px !important;
            height: 24px !important;
        }

    #logGridContainer .dx-datagrid-filter-row td .dx-editor-with-menu,
    #logGridContainer .dx-datagrid-filter-row td .dx-texteditor input {
        height: 24px !important;
        line-height: 24px !important;
        padding: 2px 6px !important;
        font-size: 12px !important;
        box-sizing: border-box;
    }

    #logGridContainer .dx-datagrid-filter-row td .dx-datebox,
    #logGridContainer .dx-datagrid-filter-row td .dx-dropdowneditor {
        height: 26px !important;
        min-height: 26px !important;
        font-size: 12px !important;
    } */
    .containerhs {
        display: flex;
        width: 100%;
        max-width: 100%;
        margin: 0 auto;
        padding: 20px;
        gap: 20px;
        justify-content: center;
    }

    .column-left {
        width: 37%;
        padding: 0 15px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .column-right {
        width: 40%;
        padding: 0 15px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    fieldset {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px 20px;

        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: box-shadow 0.3s ease;
    }

        fieldset:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

    legend {
        font-weight: 600;
        font-size: 1.1rem;
        color: #333;
        padding: 0 10px;

    }

    .form-row {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        gap: 10px;
    }

        .form-row label {
            width: 160px;
            font-size: 0.9rem;
            color: #444;
            font-weight: 500;
            flex-shrink: 0;
        }
         #roomAVG {
      right: 81px;
    position: relative;
    }
        .form-row input,
        .form-row select {
            width: 80px;
            padding: 6px 8px;
            font-size: 0.85rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;

            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            height: 30px;
           text-align: right;
        }

            .form-row input:focus,
            .form-row select:focus {
                border-color: #3b9ac6;
                box-shadow: 0 0 5px rgba(59, 154, 198, 0.3);
                outline: none;
            }

            .form-row input[disabled] {
            
                cursor: not-allowed;
            }

        .form-row.triple-input input {
            width: 80px;
            flex: 0 0 80px;
        }

        .form-row.triple-input span {
            width: 80px;
            flex: 0 0 80px;
        }

    .status-box {
        text-align: center;
        font-weight: 600;
        color: white;
        border-radius: 4px;
        padding: 6px 0;
        font-size: 0.8rem;
    }

    .green {
        background-color: #28a745;
    }

    .red {
        background-color: #dc3545;
    }

    .pink {
        background-color: #ff00ff;
    }

    .gray {
        background-color: #6c757d;
    }

    button {
        padding: 8px 20px;
        margin-top: 12px;
        cursor: pointer;
        border: none;
        border-radius: 4px;
        font-size: 0.9rem;
        font-weight: 500;
        color: white;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

        button:hover {
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

    #btnPrint {
        background-color: #3b9ac6;
    }

    #btnExportExcel {
        background-color: #28a745;
    }

    #btnExportPdf {
        background-color: #ff8c00;
    }

    .tomselect-custom {
        width: 120px;
        min-height: 30px;
        font-size: 0.85rem;
        border-radius: 4px;
    }

    .text-center {
        text-align: center;
        font-size: 1.5rem;
        font-weight: 600;
        color: #222;
        margin-bottom: 20px;
    }

    .form-row .form-row-header {
        font-weight: bold;
        width: 160px;
    }

    .form-row.header-row label {
        font-weight: bold;
        font-size: 0.85rem;
        color: #222;
    }

        .form-row.header-row label:first-child {
            width: 160px; /* khớp với label của dòng input */
            flex-shrink: 0;
        }

        .form-row.header-row label:not(:first-child) {
            width: 80px; /* khớp với input 3 cột */
            text-align: center;
        }

    .popup-overlay {
        display: none; /* Ẩn mặc định */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Nền mờ */
        z-index: 1000;
    }

    .popup-content {
        background-color: white;
        width: auto;
        max-width: fit-content;
        margin: 10% auto;
        padding: 20px;
        border-radius: 10px;
        position: relative;
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }

    .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
    }

    .popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
</style>


<div class="text-center" id="reportTitle" style="font-size: 20px"></div>
<div class="">
    <button style="border-radius: 4px;  margin-right: 6px;background-color: #3b9ac6;" id="btnPrint" class="mui-button mui-button-new"><i class="fa-solid fa-eye"></i>View</button>
@*     <button style="border-radius: 4px;  margin-right: 6px;background-color: crimson;" id="btnPrintGrid" class="mui-button mui-button-new" type="button">
        <i class="fa-solid fa-print"></i> Print
    </button> *@
   
</div>
<div class="containerhs">

    <!-- LEFT COLUMN -->
    <div class="column-left">
        <!-- Room Summary -->
        <fieldset>
            <legend>Room Summary</legend>

            <div class="form-row">
                <label for="totalRoom">Total Physical Room:</label>
                <input type="text" id="totalRoom"  disabled>
            </div>
            <div class="form-row">
                <label for="outOfOrder">Out of Order:</label>
                <input type="text" id="outOfOrder"  class="status-box pink" disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
            </div>
            <div class="form-row">
                <label for="roomToSell">Total Room to Sell:</label>
                <input type="text" id="roomToSell"  disabled>
            </div>
            <div class="form-row">
                <label for="outOfService">Out of Service:</label>
                <input type="text" id="outOfService"  class="status-box gray" disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
            </div>
        </fieldset>

        <!-- End of Day Projection -->
        <fieldset>
            <legend>End of Day Projection</legend>

            <div class="form-row  header-row" style="font-weight: bold;">
                <label style="width: 150px;"></label>
                <label style="width: 80px;">Rooms</label>
                <label style="width: 80px;">Persons</label>
                <label style="width: 80px;">VIP</label>
            </div>

            <div class="form-row triple-input">
                <label>Occupancy:</label>
                <input id="occupancyRoom" type="text" disabled>
                <input id="occupancyPersons" type="text" disabled>
                <input id="occupancyvVip" type="text"  disabled>
            </div>

            <div class="form-row">
                <label>% Occupancy:</label>
                <input id="occupancyPercent" type="text"  disabled>
      
            </div>

            <div class="form-row">
                <label>Min Available Tonight:</label>
                <input id="minAvail" type="text"  disabled>
                
            </div>

            <div class="form-row triple-input">
                <label>Max Occ Tonight:</label>
                <input id="maxaccRoom" type="text"  disabled>
                <input id="maxaccPerson" type="text"  disabled>
                <input id ="maxaccVip" type="text"  disabled>
            </div>

            <div class="form-row triple-input">
                <label>Max % Occ Tonight:</label>
                <input id="maxpercentonight" type="text"  disabled>
                
            </div>

            <div class="form-row triple-input">
                <label>Individuals:</label>
                <input id="individualsRoom" type="text"  disabled>
                <input id="individualsPerson" type="text"  disabled>
                <input id="individualsVip" type="text"  disabled>
            </div>

            <div class="form-row triple-input">
                <label>Groups:</label>
                <input id="groupRoom" type="text"  disabled>
                <input id="groupPerson" type="text" disabled>
                <input id="groupVip" type="text"  disabled>
            </div>

            <div class="form-row triple-input">
                <label>Comp and HU:</label>
                <input id="compGroup" type="text"  disabled>
                <input id="compPerson" type="text"  disabled>
                <input id="compVip" type="text"  disabled>
            </div>

            <div class="form-row triple-input">
                <label>Room Revenue:</label>
                <input id="roomRevennue" type="text"  disabled>
                <label>AVG:</label>
                <input id="roomAVG" type="text" disabled>
            </div>

           
        </fieldset>


        <!-- Search -->
        <fieldset>
            <legend>Search</legend>

            <div class="form-row">
                <label for="roomType">Room Type:</label>
                <select id="roomtype" name="roomtype" class="tomselect-custom" >
                    <option value="">--ALL--</option>
                    @foreach (var item in roomtypeList)
                    {
                        <option value="@item.ID">@item.Code</option>
                    }
                </select>
            </div>
            <div class="form-row">
                <label for="date">Date:</label>
                <input type="date" style="width: 122px;" id="datebunisess">
            </div>
            <div class="form-row">
                <label for="zone">Zone:</label>
                <select id="zone" name="zone" class="tomselect-custom" >
                    @foreach (var item in zoneList)
                    {
                        <option value="@item.ID">@item.Code</option>
                    }
                </select>
            </div>

       
        </fieldset>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="column-right">

        <!-- Activity -->
        <fieldset>
            <legend>Activity</legend>

            <div class="form-row header-row" style="font-weight: bold;">
                <label style="width: 150px;"></label>
                <label style="width: 80px;margin-right: 21px;">Rooms</label>
                <label style="width: 80px;">Persons</label>
                <label style="width: 80px;">VIP</label>
            </div>

            <div class="form-row triple-input">
                <label for="stayover">Stayovers</label>
                <input id="stayoverRoom" type="text" >
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="stayoverPerson" type="text" >
                <input id="stayoverVip" type="text" >
            </div>
            <div class="form-row triple-input">
                <label for="depExpected">Departures Expected</label>
                <input id="depExpectedRoom" type="text"  disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="depExpectedPerson" type="text"  disabled>
                <input id="depExpectedVip" type="text" disabled>
            </div>
            <div class="form-row triple-input">
                <label for="depActual">Departures Actual</label>
                <input id="actualRoom" type="text"  disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="actualPerson" type="text"  disabled>
                <input id="actualVip" type="text"  disabled>
            </div>
            <div class="form-row triple-input">
                <label for="arrExpected">Arrival Expected</label>
                <input id="arrivalExpectedRoom" type="text"  disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="arrivalExpectedPerson" type="text"  disabled>
                <input id="arrivalExpectedVip" type="text"  disabled>
            </div>
            <div class="form-row triple-input">
                <label for="arrActual">Arrival Actual</label>
                <input id="arrivalActualRoom" type="text"  disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="arrivalActualPerson" type="text"  disabled>
                <input id="arrivalActualVip" type="text" disabled>
            </div>
            <div class="form-row triple-input">
                <label for="extStay">Extended Stays</label>
                <input id="extendedStaysRoom" type="text"  disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="extendedStaysPerson" type="text" disabled>
                <input id="extendedStaysVip" type="text"  disabled>
            </div>
            <div class="form-row triple-input">
                <label for="earlyDep">Early Departures</label>
                <input id="earlyDeparturesRoom" type="text" disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id ="earlyDeparturesPerson" type="text"  disabled>
                <input id="earlyDeparturesVip" type="text"  disabled>
            </div>
            <div class="form-row triple-input">
                <label for="dayUse">Day Use Rooms</label>
                <input id="dayUseRoom" type="text"  disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id ="dayUsePerson" type="text"  disabled>
                <input id="dayUseVip" type="text"  disabled>
            </div>
            <div class="form-row triple-input">
                <label for="walkIn">Walk In</label>
                <input id="walkinRoom" type="text" disabled>
                    <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="walkinPerson" type="text"  disabled>
                <input id="walkinVip" type="text"  disabled>
            </div>
        </fieldset>


        <!-- Housekeeping Room Status -->
        <fieldset>
            <legend>House Keeping Room Status</legend>

            <!-- Header Row -->
            <div class="form-row header-row">
                <label></label>
                <label style="margin-right: 21px;">Vacant</label>
                <label>Occupied</label>
                <label>Total</label>
            </div>


            <!-- Row: Clean -->
            <div class="form-row triple-input" >
                <label>Clean</label>
                <input id="cleanVacant" type="text"  class=" green" disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="cleanOccupied" type="text"  class=" green" disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="cleanTotal" type="text"  disabled>
            </div>

            <!-- Row: Clean Non-Checked -->
            <div class="form-row  triple-input">
                <label>Clean Non-Checked</label>
                <input id="cleannonVacant" type="text"  disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="cleannonOccupied" type="text"  disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="cleannonTotal" type="text"  disabled>
            </div>

            <!-- Row: Dirty -->
            <div class="form-row triple-input">
                <label>Dirty</label>
                <input id="dirtyVacant" type="text"  class=" red" disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="dirtyOccupied" type="text"  class=" red" disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="dirtyTotal" type="text"  disabled>
            </div>

            <!-- Row: Due Out -->
            <div class="form-row triple-input">
                <label style="margin-right: 24px;">Due Out</label>
                <span></span> <!-- ô Vacant trống -->
                <input id="doeoutOccupied" type="text" disabled> <!-- ô Occupied -->
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <span></span> <!-- ô Total trống -->
            </div>
            <!-- Row: Total -->
            <div class="form-row">
                <label>Total</label>
                <input id="totalVacant" type="text"  disabled>
                <input id="totalOccupied" type="text" disabled>
               
            </div>

            <!-- Row: Out of Order -->
            <div class="form-row">
                <label>Out of Order</label>
                <input id="outoforderVacant" type="text"  class=" pink" disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
            
            </div>

            <!-- Row: Out of Service -->
            <div class="form-row">
                <label>Out of Service</label>
                <input id="outofserviveVacant" type="text"  class=" gray" disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
                <input id="outofserviveOccupied" type="text"   class=" gray" disabled>
                  <i class="fas fa-ellipsis-h ellipsis-icon" style="cursor:pointer;"></i>
            
            </div>
        </fieldset>

    </div>
</div>
<div id="popupLogGrid" style=" display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; z-index: 1050; box-shadow: 0 0 10px rgba(0,0,0,0.3); width: fit-content; max-width: 90vw; max-height: 600px; overflow-y: auto; ">

    <div class="d-flex justify-content-between mb-2">
        <h5 class="mb-0">Detail House Status</h5>
        <div class="d-flex justify-content-start mb-3 gap-2">
            <button style="border-radius: 4px;  margin-right: 6px;background-color: green;" id="btnExportExcel" class="mui-button mui-button-new" type="button"> <i class="fa-solid fa-file-excel"></i> Excel</button>
            <button onclick="$('#popupLogGrid').hide()" class="btn btn-sm btn-danger" style="background-color: #3b9ac6; border-radius: 4px;">
                <i class="fa-solid fa-xmark me-1"></i> Close
            </button>
        </div>
    </div>
    <div id="logGridContainer" class="gridContainer mt-2"></div>
</div>

<div id="loadingSpinner" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:1000;">
    <i class="fa-solid fa-spinner fa-spin"></i>
</div>
<script>

           let parsedBusinessDate = null;
        $(document).ready(function () {
                 document.getElementById("reportTitle").innerText = 'House Status';
                        var businessDateStr = '@ViewBag.BusinessDate'; // Ví dụ: '8/29/2024 12:00:00 AM'
                       console.log(businessDateStr);
                        // Lấy phần ngày tháng năm
                        var dateOnly = businessDateStr.split(' ')[0]; // '8/29/2024'
                        var dateParts = dateOnly.split('/'); // ['8', '29', '2024']

                        // Parse đúng thứ tự: new Date(year, monthIndex, day)
                         parsedBusinessDate = new Date(dateParts[2], dateParts[0] - 1, dateParts[1]);
                                  console.log(formatDate(parsedBusinessDate));
                                    $('#datebunisess').val(formatDate(parsedBusinessDate));
                       $("#btnPrint").trigger("click");

        });

            function formatDate(date) {
                let year = date.getFullYear();
                let month = (date.getMonth() + 1).toString().padStart(2, '0'); // Ð?m b?o có 2 ch? s?
                let day = date.getDate().toString().padStart(2, '0'); // Ð?m b?o có 2 ch? s?
                return `${year}-${month}-${day}`;
            }

          $(document).off("click", ".ellipsis-icon").on("click", ".ellipsis-icon", function () {
                     
                        var inputId = $(this).closest(".form-row").find("input").attr("id"); // lấy id của input

                        console.log("ID input:", inputId)
                $.ajax({
                        url: '/HouseKeeping/DataHSdetail',
                    type: 'GET',
                    data: {
                        datebunisess: $("#datebunisess").val(),
                        roomtype: $("#roomtype").val(),
                        zone: $("#zone").val(),
                                inputId:inputId,
                    },
                    headers: {
                        "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val()
                    },
                    success: function (result) {
                              if (Array.isArray(result)) {
                                
                                        initializeLogStatusGrid(result, inputId);
                                                     $("#popupLogGrid").show();
                                } else {
                                    console.error("Dữ liệu trả về không hợp lệ:", result);
                                    alert("Dữ liệu không đúng định dạng!");
                                }
                    },
                    error: function (xhr, status, error) {
                        console.error("Lỗi khi tải dữ liệu chi tiết:", error);
                    }
                });
            });


                    function initializeLogStatusGrid(data, inputId) {
        const columnWidth = 130;
        let columns = [
       
        ];
    if (inputId === "outOfService") {
        columns.push(
            { dataField: "roomName", caption: "Room Name", width: columnWidth },
            { dataField: "roomType", caption: "Room Type", width: columnWidth },
            {
                dataField: "direction",
                caption: "Direction",
                width: columnWidth
            }
        );
        } else if (inputId === "outOfOrder") {
            columns.push(
                { dataField: "roomName", caption: "Room Name", width: columnWidth },
                { dataField: "roomType", caption: "Room Type", width: columnWidth },
                {
                    dataField: "fromDate",
                    caption: "From Date",
                    width: columnWidth + 30,
                    dataType: "date",
                    format: "dd/MM/yyyy"
                },
                {
                    dataField: "toDate",
                    caption: "To Date",
                    width: columnWidth + 30,
                    dataType: "date",
                    format: "dd/MM/yyyy"
                }
            );
            } else if (inputId === "stayoverRoom") {
                columns.push(
                            { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                     { dataField: "roomNo", caption: "Room No", width: columnWidth },
                    { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                { dataField: "guest", caption: "Guest", width: columnWidth },
                    {
                            dataField: "arrivalDate",
                            caption: "Arrival Date",
                        width: columnWidth + 30,
                        dataType: "date",
                        format: "dd/MM/yyyy"
                    },
                    {
                            dataField: "departureDate",
                            caption: "Departure Date",
                        width: columnWidth + 30,
                        dataType: "date",
                        format: "dd/MM/yyyy"
                    }
                    ); }
                        else if (inputId === "depExpectedRoom") {
                    columns.push(
                                { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                         { dataField: "roomNo", caption: "Room No", width: columnWidth },
                        { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                    { dataField: "guest", caption: "Guest", width: columnWidth },
                        {
                                dataField: "arrivalDate",
                                caption: "Arrival Date",
                            width: columnWidth + 30,
                            dataType: "date",
                            format: "dd/MM/yyyy"
                        },
                        {
                                dataField: "departureDate",
                                caption: "Departure Date",
                            width: columnWidth + 30,
                            dataType: "date",
                            format: "dd/MM/yyyy"
                        }
                    );
            }
                     else if (inputId === "actualRoom") {
                        columns.push(
                                    { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                             { dataField: "roomNo", caption: "Room No", width: columnWidth },
                            { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                        { dataField: "guest", caption: "Guest", width: columnWidth },
                            {
                                    dataField: "arrivalDate",
                                    caption: "Arrival Date",
                                width: columnWidth + 30,
                                dataType: "date",
                                format: "dd/MM/yyyy"
                            },
                            {
                                    dataField: "departureDate",
                                    caption: "Departure Date",
                                width: columnWidth + 30,
                                dataType: "date",
                                format: "dd/MM/yyyy"
                            }
                            );}
                                else if (inputId === "arrivalExpectedRoom") {
                            columns.push(
                                        { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                                 { dataField: "roomNo", caption: "Room No", width: columnWidth },
                                { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                            { dataField: "guest", caption: "Guest", width: columnWidth },
                                                              { dataField: "adult", caption: "Adult", width: columnWidth },
                                                        { dataField: "child", caption: "Child", width: columnWidth },
                                {
                                        dataField: "arrivalDate",
                                        caption: "Arrival Date",
                                    width: columnWidth + 30,
                                    dataType: "date",
                                    format: "dd/MM/yyyy"
                                },
                                {
                                        dataField: "departureDate",
                                        caption: "Departure Date",
                                    width: columnWidth + 30,
                                    dataType: "date",
                                    format: "dd/MM/yyyy"
                                }
                                );}
                                else if (inputId === "arrivalActualRoom") {
                            columns.push(
                                        { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                                    { dataField: "roomNo", caption: "Room No", width: columnWidth },
                                { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                            { dataField: "guest", caption: "Guest", width: columnWidth },
                                                                { dataField: "adult", caption: "Adult", width: columnWidth },
                                                        { dataField: "child", caption: "Child", width: columnWidth },
                                                                        { dataField: "employeeCI", caption: "Employee CI", width: columnWidth },
                                {
                                        dataField: "arrivalDate",
                                        caption: "Arrival Date",
                                    width: columnWidth + 30,
                                    dataType: "date",
                                    format: "dd/MM/yyyy"
                                },
                                {
                                        dataField: "departureDate",
                                        caption: "Departure Date",
                                    width: columnWidth + 30,
                                    dataType: "date",
                                    format: "dd/MM/yyyy"
                                }
                                    );} else if (inputId === "extendedStaysRoom") {
                                columns.push(
                                            { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                                        { dataField: "roomNo", caption: "Room No", width: columnWidth },
                                    { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                                { dataField: "guest", caption: "Guest", width: columnWidth },
                                                                    { dataField: "adult", caption: "Adult", width: columnWidth },
                                                            { dataField: "child", caption: "Child", width: columnWidth },
                                     
                                    {
                                            dataField: "arrivalDate",
                                            caption: "Arrival Date",
                                        width: columnWidth + 30,
                                        dataType: "date",
                                        format: "dd/MM/yyyy"
                                    },
                                    {
                                            dataField: "departureDate",
                                            caption: "Departure Date",
                                        width: columnWidth + 30,
                                        dataType: "date",
                                        format: "dd/MM/yyyy"
                                    }
                                        );} 
                                else if (inputId === "earlyDeparturesRoom") {
                            columns.push(
                                        { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                                    { dataField: "roomNo", caption: "Room No", width: columnWidth },
                                       
                                            { dataField: "guest", caption: "Guest", width: columnWidth },

                                {
                                        dataField: "arrivalDate",
                                        caption: "Arrival Date",
                                    width: columnWidth + 30,
                                    dataType: "date",
                                    format: "dd/MM/yyyy"
                                },
                                {
                                        dataField: "departureDate",
                                        caption: "Departure Date",
                                    width: columnWidth + 30,
                                    dataType: "date",
                                    format: "dd/MM/yyyy"
                                }
                                    );}   else if (inputId === "dayUseRoom") {
                                columns.push(
                                            { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                                        { dataField: "roomNo", caption: "Room No", width: columnWidth },
                                                                  { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                                { dataField: "guest", caption: "Guest", width: columnWidth },

                                    {
                                            dataField: "arrivalDate",
                                            caption: "Arrival Date",
                                        width: columnWidth + 30,
                                        dataType: "date",
                                        format: "dd/MM/yyyy"
                                    },
                                    {
                                            dataField: "departureDate",
                                            caption: "Departure Date",
                                        width: columnWidth + 30,
                                        dataType: "date",
                                        format: "dd/MM/yyyy"
                                    }
                                        );} else if (inputId === "walkinRoom") {
                                    columns.push(
                                                { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                                            { dataField: "roomNo", caption: "Room No", width: columnWidth },
                                                                      { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                                    { dataField: "guest", caption: "Guest", width: columnWidth },

                                        {
                                                dataField: "arrivalDate",
                                                caption: "Arrival Date",
                                            width: columnWidth + 30,
                                            dataType: "date",
                                            format: "dd/MM/yyyy"
                                        },
                                        {
                                                dataField: "departureDate",
                                                caption: "Departure Date",
                                            width: columnWidth + 30,
                                            dataType: "date",
                                            format: "dd/MM/yyyy"
                                        }
                                    );}
                                    else if (inputId === "cleanVacant") {
                                columns.push(
                                    { dataField: "roomName", caption: "Room Name", width: columnWidth },
                                    { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                { dataField: "zone", caption: "Zone", width: columnWidth },
                                    );}
                                        else if (inputId === "cleanOccupied") {
                            columns.push(
                                { dataField: "roomName", caption: "Room Name", width: columnWidth },
                                { dataField: "roomType", caption: "Room Type", width: columnWidth },
                            { dataField: "zone", caption: "Zone", width: columnWidth },
                                );}
                                        else if (inputId === "cleannonVacant") {
                        columns.push(
                            { dataField: "roomName", caption: "Room Name", width: columnWidth },
                            { dataField: "roomType", caption: "Room Type", width: columnWidth },
                        { dataField: "zone", caption: "Zone", width: columnWidth },
                            );}
                            else if (inputId === "cleannonOccupied") {
                columns.push(
                    { dataField: "roomName", caption: "Room Name", width: columnWidth },
                    { dataField: "roomType", caption: "Room Type", width: columnWidth },
                { dataField: "zone", caption: "Zone", width: columnWidth },
                    );}
                    else if (inputId === "doeoutOccupied") {
                    columns.push(
                                { dataField: "reservationNumber", caption: "Reservation Number", width: columnWidth },
                                            { dataField: "roomNo", caption: "Room No", width: columnWidth },
                                                        { dataField: "roomType", caption: "Room Type", width: columnWidth },
                                    { dataField: "guest", caption: "Guest", width: columnWidth },

                        {
                                dataField: "arrivalDate",
                                caption: "Arrival Date",
                            width: columnWidth + 30,
                            dataType: "date",
                            format: "dd/MM/yyyy"
                        },
                        {
                                dataField: "departureDate",
                                caption: "Departure Date",
                            width: columnWidth + 30,
                            dataType: "date",
                            format: "dd/MM/yyyy"
                        }
                    );}
                                else if (inputId === "dirtyVacant") {
                    columns.push(
                        { dataField: "roomName", caption: "Room Name", width: columnWidth },
                        { dataField: "roomType", caption: "Room Type", width: columnWidth },
                    { dataField: "zone", caption: "Zone", width: columnWidth },
                        );}
                                else if (inputId === "dirtyOccupied") {
                columns.push(
                    { dataField: "roomName", caption: "Room Name", width: columnWidth },
                    { dataField: "roomType", caption: "Room Type", width: columnWidth },
                { dataField: "zone", caption: "Zone", width: columnWidth },
                    );}
                            else if (inputId === "outoforderVacant") {
                    columns.push(
                        { dataField: "roomName", caption: "Room Name", width: columnWidth },
                        { dataField: "roomType", caption: "Room Type", width: columnWidth },
                    { dataField: "zone", caption: "Zone", width: columnWidth },
                            );}
                                else if (inputId === "outofserviveVacant") {
                        columns.push(
                            { dataField: "roomName", caption: "Room Name", width: columnWidth },
                            { dataField: "roomType", caption: "Room Type", width: columnWidth },
                        { dataField: "zone", caption: "Zone", width: columnWidth },
                            );}
                                       else if (inputId === "outofserviveOccupied") {
                            columns.push(
                                { dataField: "roomName", caption: "Room Name", width: columnWidth },
                                { dataField: "roomType", caption: "Room Type", width: columnWidth },
                            { dataField: "zone", caption: "Zone", width: columnWidth },
                                );}
            $("#logGridContainer").dxDataGrid({
            dataSource: data,
            allowColumnResizing: true,
            columnAutoWidth: true,
            showBorders: true,
                     // width: "100%",
               height: 500,
                    columns: columns,
            paging: { pageSize: 25 },
            scrolling: {
                useNative: true,
                showScrollbar: "always"
            },
            pager: {
                visible: true,
                allowedPageSizes: [25, 50, 'all'],
                showPageSizeSelector: true,
                showInfo: true,
                showNavigationButtons: true
            },
            filterRow: { visible: true, applyFilter: "auto" },
            headerFilter: { visible: true },
            selection: { mode: "multiple", showCheckBoxesMode: "none" },
            onRowPrepared: function (e) {
                if (e.rowType === "data" && e.data?.isTotal) {
                    e.rowElement.css({
                        "font-weight": "bold",
                        "background-color": "#f6f6f6"
                    });
                }
            }
        });
    }


         $(document).off("click", "#btnPrint").on("click", "#btnPrint", function () {
            $("#loadingSpinner").show();
            $.ajax({
             url: '/HouseKeeping/HouseStatusData',
                type: 'GET',
                data: {
                    datebunisess: $("#datebunisess").val(),
                    roomtype: $("#roomtype").val(),
                    zone: $("#zone").val(),
                },
                traditional: true,
                  crossDomain: false,
                    headers: { "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val() },
                success: function (result) {
                console.log(result);
                                     const totalRoom = parseInt(result.totalPhysicalRoom[0].totalPhysicalRoom) || 0;
                            const outOfOrder = parseInt(result.outOfOrder[0].outOfOrder) || 0;

                            // Gán giá trị tổng phòng
                            $('#totalRoom').val(totalRoom);

                            // Gán giá trị phòng Out Of Order
                            $('#outOfOrder').val(outOfOrder);

                            // Tính số phòng có thể bán
                            const roomToSell = totalRoom - outOfOrder;
                            $('#roomToSell').val(roomToSell);

                          let stayOverdepartureExpected = parseInt(result.departureExpected[0].totalRooms ) || 0;

                                 let occupancyPersonsstayOver = parseInt(result.stayOver[0].totalPersons ) || 0;
                          let occupancyPersonsdepartureExpected = parseInt(result.departureExpected[0].totalPersons ) || 0;

                                 let occupancyRoomstayOver = parseInt(result.stayOver[0].totalRooms ) || 0;
                      $('#outOfService').val(result.outOfService[0].outOfService);
                      const occupancyRoom = occupancyRoomstayOver + stayOverdepartureExpected;
                     $('#occupancyRoom').val(occupancyRoom);
                     let occupancyPercent = 0;
                        if (roomToSell > 0) {
                            occupancyPercent = (occupancyRoom * 100) / roomToSell;
                         occupancyPercent = parseFloat(occupancyPercent.toFixed(2));// làm tròn 2 chữ số thập phân
                        }

                        $('#occupancyPercent').val(occupancyPercent.toFixed(2));

                         let maxaccRoom = parseInt(result.endOfDayMaxOccTonight[0].totalRooms) || 0;
                         $('#minAvail').val(roomToSell-maxaccRoom);

                    $('#occupancyPersons').val(occupancyPersonsstayOver+occupancyPersonsdepartureExpected);
                     $('#occupancyvVip').val(result.arrivalActualVIP[0].vip);
                 $('#maxaccRoom').val(maxaccRoom);
                      let maxoccupancyPercent = 0;
                    
                            maxoccupancyPercent = (maxaccRoom * 100) / roomToSell;
                           maxoccupancyPercent = parseFloat(maxoccupancyPercent.toFixed(2));  // làm tròn 2 chữ số thập phân
                        

                 $('#maxpercentonight').val(maxoccupancyPercent.toFixed(2));
                  $('#maxaccPerson').val(result.endOfDayMaxOccTonight[0].totalPersons);
                    $('#maxaccVip').val(result.endOfDayMaxOccTonightVIP[0].vip);

             $('#individualsRoom').val(result.endOfDayIndividual[0].totalRooms);
              $('#individualsPerson').val(result.endOfDayIndividual[0].totalPersons);
              $('#individualsVip').val(result.endOfDayIndividualVIP[0].vip);

       $('#groupRoom').val(result.endOfDayGroupAndBlock[0].totalRooms);
    $('#groupPerson').val(result.endOfDayGroupAndBlock[0].totalPersons);
        $('#groupVip').val(result.endOfDayGroupAndBlockVIP[0].vip);

           $('#compGroup').val(result.endOfDayCHU[0].totalRooms);
    $('#compPerson').val(result.endOfDayCHU[0].totalPersons);
        $('#compVip').val(result.endOfDayCHUVIP[0].vip);

const amount = parseFloat(result.endOfDayRoomRevenue[0].amount) || 0;

// Làm tròn xuống số nguyên
const roundedAmount = Math.round(amount);

// Định dạng tiền theo kiểu Việt Nam: 1.234.567
const formattedAmount = roundedAmount.toLocaleString('vi-VN');

$('#roomRevennue').val(formattedAmount);
 
    var roomCount = parseFloat(maxaccRoom) || 0;
            console.log(amount);
        if (roomCount > 0) {
                    var avg = amount / roomCount;
                    var formattedAvg = avg.toLocaleString('vi-VN', { maximumFractionDigits: 0 });

            $('#roomAVG').val(formattedAvg);
    } else {
        $('#roomAVG').val('0.000'); // hoặc để trống nếu bạn muốn
    }


             $('#stayoverRoom').val(result.stayOver[0].totalRooms);
         $('#stayoverPerson').val(result.stayOver[0].totalPersons);
           $('#stayoverVip').val(result.stayOverVIP[0].vip);

                 $('#depExpectedRoom').val(result.departureExpected[0].totalRooms);
         $('#depExpectedPerson').val(result.departureExpected[0].totalPersons);
           $('#depExpectedVip').val(result.departureExpectedVIP[0].vip);

                $('#actualRoom').val(result.departureActual[0].totalRooms);
         $('#actualPerson').val(result.departureActual[0].totalPersons);
           $('#actualVip').val(result.departureActualVIP[0].vip);

                $('#arrivalExpectedRoom').val(result.arrivalExpected[0].totalRooms);
         $('#arrivalExpectedPerson').val(result.arrivalExpected[0].totalPersons);
           $('#arrivalExpectedVip').val(result.arrivalExpectedVIP[0].vip);

                $('#arrivalActualRoom').val(result.arrivalActual[0].totalRooms);
         $('#arrivalActualPerson').val(result.arrivalActual[0].totalPersons);
           $('#arrivalActualVip').val(result.arrivalActualVIP[0].vip);

               $('#extendedStaysRoom').val(result.extendedStay[0].totalRooms);
         $('#extendedStaysPerson').val(result.extendedStay[0].totalPersons);
           $('#extendedStaysVip').val(result.extendedStayVIP[0].vip);

                    $('#earlyDeparturesRoom').val(result.earlyDeparture[0].totalRooms);
         $('#earlyDeparturesPerson').val(result.earlyDeparture[0].totalPersons);
           $('#earlyDeparturesVip').val(result.earlyDepartureVIP[0].vip);

                    $('#dayUseRoom').val(result.dayUseRoom[0].totalRooms);
         $('#dayUsePerson').val(result.dayUseRoom[0].totalPersons);
           $('#dayUseVip').val(result.dayUseRoomVIP[0].vip)

                         $('#walkinRoom').val(result.walkInRoom[0].totalRooms);
         $('#walkinPerson').val(result.walkInRoom[0].totalPersons);
           $('#walkinVip').val(result.wakeInRoomVIP[0].vip)

             $('#cleanVacant').val(result.hkInspected[0].vacant);
            $('#cleanOccupied').val(result.hkInspected[0].occ);

            // Tính tổng và gán vào cleanTotal
            let vacantIns = parseInt(result.hkInspected[0].vacant) || 0;
            let occIns = parseInt(result.hkInspected[0].occ) || 0;
            $('#cleanTotal').val(vacantIns + occIns);

                $('#cleannonVacant').val(result.hkClean[0].vacant);
               $('#cleannonOccupied').val(result.hkClean[0].occ);

                // Tính tổng và gán vào cleanTotal
                let vacanthk = parseInt(result.hkClean[0].vacant) || 0;
                let occhk = parseInt(result.hkClean[0].occ) || 0;
                $('#cleannonTotal').val(vacanthk + occhk);


                  $('#dirtyVacant').val(result.hkDirty[0].vacant);
               $('#dirtyOccupied').val(result.hkDirty[0].occ);

                // Tính tổng và gán vào cleanTotal
                let vacanthkD = parseInt(result.hkDirty[0].vacant) || 0;
                let occhkD = parseInt(result.hkDirty[0].occ) || 0;
                        let txtDO = parseInt(result.roomzone.length) || 0;
               
                $('#dirtyTotal').val(vacanthkD + occhkD);


               $('#doeoutOccupied').val(result.roomzone ? result.roomzone.length : 0);


                //  let vacantIns = parseInt(result.hkInspected[0].vacant) || 0;
                //  let occIns = parseInt(result.hkInspected[0].occ) || 0;
                //   let vacanthk = parseInt(result.hkClean[0].vacant) || 0;
                // let occhk = parseInt(result.hkClean[0].occ) || 0;
                //         let vacanthkD = parseInt(result.hkDirty[0].vacant) || 0;
                // let occhkD = parseInt(result.hkDirty[0].occ) || 0;

                   $('#totalVacant').val(vacantIns + vacanthk+vacanthkD);
                       $('#totalOccupied').val(occIns + occhk+occhkD+txtDO);

                   $('#outoforderVacant').val(result.hkOutOfOrder[0].vacant);
                    $('#outofserviveVacant').val(result.hkOutOfService[0].vacant);
                   $('#outofserviveOccupied').val(result.hkOutOfService[0].occ);
                $("#loadingSpinner").hide();
                },
                error: function () {
                    alert("Eror");
                    $("#loadingSpinner").hide();
                }
            });
        });

           $("#btnExportExcel").click(function () {
                       const grid = $("#logGridContainer").dxDataGrid("instance");
                var selectedReport = 'Detail House Status';
            if (!selectedReport) {
                alert("Vui lòng chọn báo cáo trước khi xuất Excel.");
                return;
            }

                         const workbook = new ExcelJS.Workbook();const companyName = localStorage.getItem("CompanyName") || "Tên công ty chưa xác định";
            const worksheet = workbook.addWorksheet("Sheet 1");

            // === Tạo header công ty (dòng 1) ===
           worksheet.addRow([companyName]);
            worksheet.mergeCells('A1:E1');
            worksheet.getRow(1).font = { bold: true };
            worksheet.getRow(1).alignment = { vertical: 'middle', horizontal: 'left' };

            // === Dòng 2: Thời gian xuất (phải) ===
            const now = new Date();
            const exportDate = now.toLocaleString("vi-VN");
            worksheet.addRow(['', '', '', '', ' ' + exportDate]);
            worksheet.mergeCells('E2:H2');
            worksheet.getRow(2).alignment = { vertical: 'middle', horizontal: 'right' };

            // === Dòng 3–4: Trống
            worksheet.addRow([]);
            worksheet.addRow([]);

            // === Dòng 5: Tên báo cáo ở giữa ===
            const reportRow = worksheet.addRow(['', '', selectedReport]);
            worksheet.mergeCells('C5:F5');
            reportRow.font = { bold: true, size: 14 };
            reportRow.alignment = { vertical: 'middle', horizontal: 'center' };

            // === Dòng 6: Trống trước khi xuất dữ liệu
            worksheet.addRow([]);

            // === Export dữ liệu từ DevExtreme (bắt đầu từ dòng 7)
            DevExpress.excelExporter.exportDataGrid({
                component: grid,
                worksheet: worksheet,
                autoFilterEnabled: true,
                topLeftCell: { row: 7, column: 1 } // dữ liệu bắt đầu từ dòng 7
            }).then(function () {
                // Footer
                const lastRow = worksheet.lastRow.number + 2;

                worksheet.mergeCells(`A${lastRow}:F${lastRow}`);
                worksheet.getCell(`A${lastRow}`).alignment = { horizontal: 'center' };
                worksheet.getCell(`A${lastRow}`).font = { italic: true };

                // Ghi file
                let fileName = selectedReport + ".xlsx";
                workbook.xlsx.writeBuffer().then(function (buffer) {
                    saveAs(new Blob([buffer], { type: "application/octet-stream" }), fileName);
                });
            });
        });
        
</script>