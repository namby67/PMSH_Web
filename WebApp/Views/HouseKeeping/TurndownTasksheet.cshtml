@using DevExpress.XtraReports.UI
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewBag.Title = ViewBag.ReportHeader;
    var listatt = ViewBag.hkpAttendantList;
}
@* <link asp-append-version="true" href="~/css/reservation.css" rel="stylesheet" /> *@

<style>
    /*   #logGridContainer .dx-datagrid-rowsview .dx-selection {
            background-color: #005f87 !important;
            color: white !important;
        }

            #logGridContainer .dx-datagrid-rowsview .dx-selection * {
                color: white !important;
            }

        #logGridContainer .dx-datagrid-rowsview .dx-row > td {
            padding-top: 2px !important;
            padding-bottom: 2px !important;
            font-size: 12px !important;
            line-height: 24px !important;
        }

        #logGridContainer .dx-datagrid-headers {
            background-color: #3b9ac6 !important;
            color: white !important;
        }

            #logGridContainer .dx-datagrid-headers .dx-header-row > td {
                padding-top: 12px !important;
                padding-bottom: 12px !important;
                font-size: 12px !important;
                background-color: #3b9ac6 !important;
                color: white !important;
                font-weight: bold;
                border-right: 1px solid #ddd !important;
                text-align: center !important;
            }

            #logGridContainer .dx-datagrid-rowsview td,
            #logGridContainer .dx-datagrid-headers td {
                border-right: 1px solid #ddd !important;
            }


            #logGridContainer .dx-datagrid-rowsview tr td:last-child,
            #logGridContainer .dx-datagrid-headers tr td:last-child {
                border-right: none !important;
            }

        #logGridContainer .dx-datagrid-rowsview .dx-selection {
            background-color: #01579b !important;
            color: white !important;
        }

            #logGridContainer .dx-datagrid-rowsview .dx-selection * {
                color: white !important;
            }

        #logGridContainer .dx-datagrid-filter-row td .dx-datebox {
            height: 24px !important;
            min-height: 24px !important;
        }

            #logGridContainer .dx-datagrid-filter-row td .dx-datebox input {
                font-size: 12px !important;
                height: 24px !important;
            }

        #logGridContainer .dx-datagrid-filter-row td .dx-editor-with-menu,
        #logGridContainer .dx-datagrid-filter-row td .dx-texteditor input {
            height: 24px !important;
            line-height: 24px !important;
            padding: 2px 6px !important;
            font-size: 12px !important;
            box-sizing: border-box;
        }

        #logGridContainer .dx-datagrid-filter-row td .dx-datebox,
        #logGridContainer .dx-datagrid-filter-row td .dx-dropdowneditor {
            height: 26px !important;
            min-height: 26px !important;
            font-size: 12px !important;
        }

        #gridContainer .dx-datagrid-rowsview .dx-selection {
            background-color: #005f87 !important;
            color: white !important;
        }

            #gridContainer .dx-datagrid-rowsview .dx-selection * {
                color: white !important;
            }

        .dx-datagrid-headers .dx-header-row td {
            white-space: pre-line !important;
            text-align: center;
            font-size: 11px;
        }


        .dx-datagrid .dx-editor-with-menu .dx-menu-item-content .dx-icon.dx-icon-filter-operation-default, .dx-datagrid-container .dx-editor-with-menu .dx-menu-item-content .dx-icon.dx-icon-filter-operation-default {
            display: none;
        }

        #gridContainer .dx-datagrid-rowsview .dx-row > td {
            padding-top: 2px !important;
            padding-bottom: 2px !important;
            font-size: 12px !important;
            line-height: 24px !important;
        }

        #gridContainer .dx-datagrid-headers {
            background-color: #3b9ac6 !important;
            color: white !important;
        }

            #gridContainer .dx-datagrid-headers .dx-header-row > td {
                padding-top: 12px !important;
                padding-bottom: 12px !important;
                font-size: 12px !important;
            }

            #gridContainer .dx-datagrid-headers .dx-header-row > td {
                background-color: #3b9ac6 !important;
                color: white !important;
                font-weight: bold;
                border-right: 1px solid #ddd !important;
                text-align: center !important;
            }

            #gridContainer .dx-datagrid-rowsview td,
            #gridContainer .dx-datagrid-headers td {
                border-right: 1px solid #ddd !important;
            }

            #gridContainer .dx-datagrid-rowsview tr td:last-child,
            #gridContainer .dx-datagrid-headers tr td:last-child {
                border-right: none !important;
            }

        #gridContainer .dx-datagrid-rowsview .dx-selection {
            background-color: #01579b !important;
            color: white !important;
        }

            #gridContainer .dx-datagrid-rowsview .dx-selection * {
                color: white !important;
            }

        #gridContainer .dx-datagrid-filter-row td .dx-datebox {
            height: 24px !important;
            min-height: 24px !important;
        }

            #gridContainer .dx-datagrid-filter-row td .dx-datebox input {
                font-size: 12px !important;
                height: 24px !important;
            }

        #gridContainer .dx-datagrid-filter-row td .dx-editor-with-menu,
        #gridContainer .dx-datagrid-filter-row td .dx-texteditor input {
            height: 24px !important;
            line-height: 24px !important;
            padding: 2px 6px !important;
            font-size: 12px !important;
            box-sizing: border-box;
        }

        #gridContainer .dx-datagrid-filter-row td .dx-datebox,
        #gridContainer .dx-datagrid-filter-row td .dx-dropdowneditor {
            height: 26px !important;
            min-height: 26px !important;
            font-size: 12px !important;
        } */


    .filter_wrapper {
        /*     background-color: #ececec; */
        /*   margin: 0px 8px 14px 8px; */
        padding: 18px 0px 0px 14px;
        border-radius: 8px;
    }

    .gridContainer {
        margin: 0px 8px;
    }

    .button_wrapper {
        display: flex;
        column-gap: 12px;
        margin: 0px 8px;
    }

        .button_wrapper .fa-solid {
            margin-right: 5px;
        }

    .selected {
        background-color: #4CAF50; /* Màu xanh */
        color: white;
    }

    /*     #gridContainer .dx-datagrid-rowsview .dx-selection {
            background-color: #01579b !important;
            color: white !important;
        } */

    #gridContainer .dx-datagrid-rowsview .dx-selection * {
        color: white !important;
    }

    .sticky-header .form-control-sm {
        padding: .1rem .35rem;
        height: calc(1.1em + .2rem + 2px);
    }

    .sticky-header label[class*="me-"] {
        margin-right: .5rem !important;
    }

    #gridContainer .dx-datagrid-headers .dx-header-row > td {
        padding: 5px !important;
        height: 24px !important;
        font-size: 12px !important;
        line-height: 1.1 !important;
    }

    .sticky-header input[type="date"].form-control-sm {
        font-size: 12px !important; /* dúng 12?px */
        height: calc(1.1em + .2rem + 2px); /* gi? cùng chi?u cao */
    }

    .sticky-header label {
        font-size: 12px !important;
        line-height: 1.2;
    }

    .tomselect-custom {
        width: 250px;
        min-height: 30px; /* ho?c tùy theo chi?u cao b?n mu?n */
        font-size: 0.65rem;
    }

    .sort-select {
        max-width: 130px; /* ho?c 100px n?u mu?n nh? hon */
        font-size: 12px;
        padding: 0.15rem 0.5rem;
    }

    .sort-select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: none !important;
        padding-right: 10px !important;
    }

    .status-color-box {
        display: inline-block;
        width: 16px;
        height: 16px;
        margin-right: 4px;
        vertical-align: middle;
        border: 1px solid #ccc;
    }

    .color-clean-uncheck {
        background-color: cyan;
    }

    .color-dirty {
        background-color: red;
    }

    .color-outoforder {
        background-color: lightgray;
    }

    .color-pickup {
        background-color: yellow;
    }

    .color-clean {
        background-color: lime;
    }

    .color-outofservices {
        background-color: lightgray;
    }

    .hk-clean-uncheck {
        background-color: cyan;
        color: black;
    }

    .hk-dirty {
        background-color: red;
        color: white;
    }

    .hk-outoforder {
        background-color: lightgray;
        color: black;
    }

    .hk-pickup {
        background-color: yellow;
        color: black;
    }

    .hk-clean {
        background-color: lime;
        color: black;
    }

    .hk-outofservices {
        background-color: lightgray;
        color: black;
    }
</style>
<link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
<div class="text-center" id="reportTitle" style="font-size: 20px"></div>
<div class="sticky-header bg-white p-2 shadow-sm z-3">
    <div class="d-flex flex-wrap align-items-center gap-2 mb-1 filter-panel">
        <!-- From Date -->
        <div class="d-flex flex-column">
            <div class="d-flex align-items-center me-3">
                <label class="mb-1 me-2">Room Status: </label>

                <!-- Clean Uncheck -->
                <div class="form-check me-3">
                    <span class="status-color-box color-clean-uncheck"></span>
                    <input class="form-check-input" type="checkbox" id="cleanUncheck" name="includeOptions" value="1" checked>
                    <label class="form-check-label" for="cleanUncheck">Clean Non-Checked</label>
                </div>

                <!-- Dirty -->
                <div class="form-check me-3">
                    <span class="status-color-box color-dirty"></span>
                    <input class="form-check-input" type="checkbox" id="dirty" name="includeOptions" value="2" checked>
                    <label class="form-check-label" for="dirty">Dirty</label>
                </div>

                <!-- Out of Order -->
                <div class="form-check me-3">
                    <span class="status-color-box color-outoforder"></span>
                    <input class="form-check-input" type="checkbox" id="outofOrder" name="includeOptions" value="5" checked>
                    <label class="form-check-label" for="outofOrder">Out of Order</label>
                </div>

                <!-- Pickup -->
                <div class="form-check me-3">
                    <span class="status-color-box color-pickup"></span>
                    <input class="form-check-input" type="checkbox" id="pickup" name="includeOptions" value="3" checked>
                    <label class="form-check-label" for="pickup">Pickup</label>
                </div>

                <!-- Clean -->
                <div class="form-check me-3">
                    <span class="status-color-box color-clean"></span>
                    <input class="form-check-input" type="checkbox" id="clean" name="includeOptions" value="4" checked>
                    <label class="form-check-label" for="clean">Clean</label>
                </div>

                <!-- Out of Services -->
                <div class="form-check me-3">
                    <span class="status-color-box color-outofservices"></span>
                    <input class="form-check-input" type="checkbox" id="outofServices" name="includeOptions" value="6" checked>
                    <label class="form-check-label" for="outofServices">Out of Services</label>
                </div>
            </div>
        </div>
        <div class="d-flex flex-column ">

            <div class="d-flex align-items-center">

                <div class="d-flex align-items-center me-3">
                    <label class="me-2 mb-0">Attendant ID:</label>
                    <select id="attendant" name="attendant" class="tomselect-custom" multiple>
                        @foreach (var item in listatt)
                        {
                            <option value="@item.ID">@item.Name</option>
                        }
                    </select>

                </div>

             
                <div class="d-flex align-items-center me-3" style="display:none !important">
                    <label class="me-2 mb-0">Task Date:</label>
                    <input type="date" id="fromDate" name="fromDate" class="form-control form-control-sm w-auto" />
                </div>
            </div>
        </div>


    </div>
    <div class="">
        <button style="border-radius: 4px;  margin-right: 6px;background-color: #3b9ac6;" id="btnPrint" class="mui-button mui-button-new"><i class="fa-solid fa-eye"></i>View</button>
        <button style="border-radius: 4px;  margin-right: 6px;" id="btnCheckAll" class="mui-button mui-button-advance" type="button"> <i class="fa-solid fa-check-double"></i> Check All</button>
        <button style="border-radius: 4px;  margin-right: 6px;" id="btnDailytasksheet" class="mui-button mui-button-profile" type="button"><i class="fa-solid fa-calendar-check"></i>Daily</button>
        <button style="border-radius: 4px;  margin-right: 6px;background-color: green;" id="btnExportExcel" class="mui-button mui-button-new" type="button"> <i class="fa-solid fa-file-excel"></i> Excel</button>

    </div>
</div>

<div id="overlay" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 999;"></div>

<div id="popupNewGrid" style="display: none; position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px;
    z-index: 1050; box-shadow: 0 0 10px rgba(0,0,0,0.3);   width: 100vw; max-width: 100vw; max-height: 800px; overflow-y: auto;">

    <div class="d-flex justify-content-between mb-2">
        <h5 id="attendantPointTitle" class="mb-0">Turndown Tasksheet</h5>

    </div>
    <div class="d-flex justify-content-start mb-3 gap-2">
        <button style="border-radius: 4px;  margin-right: 6px;background-color: green;" id="btnExportpopExcel" class="mui-button mui-button-new" type="button"> <i class="fa-solid fa-file-excel"></i> Excel</button>

        <button onclick="$('#popupNewGrid').hide()" id="btnClosePopup" class="btn btn-sm btn-danger" style="background-color: #3b9ac6; border-radius: 4px;">
            <i class="fa-solid fa-xmark me-1"></i> Close
        </button>
    </div>



    <div id="logGridContainer" class="gridContainer mt-2"></div>
</div>

<div class="mui-card">
    <div id="gridContainer" class="gridContainer mt-2"></div>
</div>
<div id="loadingSpinner" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:1000;">
    <i class="fa-solid fa-spinner fa-spin"></i>
</div>
<script>
        function formatDate(date) {
            let year = date.getFullYear();
            let month = (date.getMonth() + 1).toString().padStart(2, '0'); // Ð?m b?o có 2 ch? s?
            let day = date.getDate().toString().padStart(2, '0'); // Ð?m b?o có 2 ch? s?
            return `${year}-${month}-${day}`;
        }

            let parsedBusinessDate = null;
        $(document).ready(function () {

             document.getElementById("reportTitle").innerText = 'Turndown Tasksheet';
              var businessDateStr = '@ViewBag.BusinessDate'; // Ví dụ: '8/29/2024 12:00:00 AM'
                   console.log(businessDateStr);
                    // Lấy phần ngày tháng năm
                    var dateOnly = businessDateStr.split(' ')[0]; // '8/29/2024'
                    var dateParts = dateOnly.split('/'); // ['8', '29', '2024']

                    // Parse đúng thứ tự: new Date(year, monthIndex, day)
                     parsedBusinessDate = new Date(dateParts[2], dateParts[0] - 1, dateParts[1]);

                    // Gán vào input type="date"
                    $('#fromDate').val(formatDate(parsedBusinessDate));

               initializeTomSelects();

                                           $("#btnPrint").trigger("click");

        });
             $("#btnReport").on("click", function () {

                   $('#overlay').fadeIn(200);
                    $('#popupNewGrid').fadeIn(200);
            });
             $('#btnClosePopup, #overlay').click(function () {
                $('#popupNewGrid').fadeOut(200);
                $('#overlay').fadeOut(200);

            });
            // function initializeTomSelectstasksheet() {
            //     const selectors = ["#tasksheet"];

            //     for (const id of selectors) {
            //         const el = document.querySelector(id);
            //         if (!el) continue;

            //         // Nếu đã khởi tạo rồi thì destroy
            //         if (el.tomselect) el.tomselect.destroy();

            //         const ts = new TomSelect(el, {
            //             plugins: ['remove_button'],
            //             create: false,
            //             maxItems: null,
            //             allowEmptyOption: true,
            //             placeholder: '',
            //             persist: false,
            //             render: {
            //                 option: function (data, escape) {
            //                     return `<div>${escape(data.text)}</div>`;
            //                 }
            //             }
            //         });

            //     }
            // }
        function initializeTomSelects() {
                const selectors = ["#attendant"];

                for (const id of selectors) {
                    const el = document.querySelector(id);
                    if (!el) continue;

                    if (el.tomselect) el.tomselect.destroy();

                    const ts = new TomSelect(el, {
                        plugins: ['remove_button'],
                        create: false,
                        maxItems: null,
                        allowEmptyOption: true,
                        placeholder: '',
                        persist: false,
                        render: {
                            option: function (data, escape) {
                                return `<div>${escape(data.text)}</div>`;
                            }
                        }
                    });

                }
            }

        $(document).off("click", "#btnPrint").on("click", "#btnPrint", function () {
            $("#loadingSpinner").show();
               var selectedStatuses = $("input[name='includeOptions']:checked")
                .map(function () {
                    return this.value;
                }).get().join(",");
            $.ajax({
                url: '/HouseKeeping/TurndownTasksheetData',
                type: 'GET',
                data: {
                    fromDate: $("#fromDate").val(),
                    attendant: $("#attendant").val().join(","),
                    IsDueOut: $("#dirty").prop("checked") ? "1" : "",
                     roomStatus: selectedStatuses,
                },
                traditional: true,
                  crossDomain: false,
                    headers: { "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val() },
                success: function (data) {
                    // $("#reportViewerContainer").html(result);
                    // $("#loadingSpinner").hide();
                             console.log(data);
                            initializeTurndownTasksheetDataGrid(data);
                            initializeTurndownTasksheetGrid(data);
                        $("#loadingSpinner").hide();
                },
                error: function () {
                    alert("Không th? t?i báo cáo.");
                    $("#loadingSpinner").hide();
                }
            });
        });

            function initializeTurndownTasksheetDataGrid(data) {
        const columnWidth = 120;

        $("#gridContainer").dxDataGrid({
            dataSource: data,
            allowColumnResizing: true,
            columnAutoWidth: true,
             height: 600,
            columns: [
               
                 {dataField: "hkstatusID_color",
                        caption: "C",
                        width: columnWidth-40,
                        cellTemplate: function (container, options) {
                            let colorClass = "";
                            switch (options.value) {
                                case "Clean Non-Checked":
                                    colorClass = "hk-clean-uncheck";
                                    break;
                                case "Dirty":
                                    colorClass = "hk-dirty";
                                    break;
                                case "Out Of Order":
                                    colorClass = "hk-outoforder";
                                    break;
                                case "Pickup":
                                    colorClass = "hk-pickup";
                                    break;
                                case "Clean":
                                    colorClass = "hk-clean";
                                    break;
                                case "Out Of Services":
                                    colorClass = "hk-outofservices";
                                    break;
                                default:
                                    colorClass = "";
                            }

                            $(container)
                            .addClass(colorClass)
                            .css({
                                "text-align": "center",
                                "color": "#000" // màu chữ
                            });
                        }
                    },
                    { dataField: "Sheet No", caption: "Sheet No", width: columnWidth },
                { dataField: "roomNo", caption: "Room No", width: columnWidth },
                  { dataField: "attendant", caption: "Attendant", width: columnWidth, groupIndex: 0 , visible: false}, // <-- Group theo Attendant
                { dataField: "roomType", caption: "Room Type", width: columnWidth },
                { dataField: "credits", caption: "Credits", width: columnWidth , dataType: "number", format: "#,##0" },
                { dataField: "facilityTask", caption: "Facility Task", width: columnWidth },
                { dataField: "hkstatusID_color", caption: "Room Status", width: columnWidth},
                  { dataField: "foStatus", caption: "FO Status", width: columnWidth},
                { dataField: "timeIn", caption: "Time In", width: columnWidth },
                { dataField: "timeOut", caption: "Time Out", width: columnWidth },
                  { dataField: "Description", caption: "Description", width: columnWidth },
            ],


            paging: { pageSize: 25 },
            scrolling: {
                useNative: true,
                showScrollbar: "always"
            },
            pager: {
                visible: true,
                allowedPageSizes: [25, 50, 'all'],
                showPageSizeSelector: true,
                showInfo: true,
                showNavigationButtons: true
            },
            filterRow: { visible: true, applyFilter: "auto" },
            headerFilter: { visible: true },
            selection: { mode: "multiple", showCheckBoxesMode: "always" },
            showBorders: true,

            onRowClick: function (e) {
                selectedRowData = e.data; // lưu dòng được chọn
            }
            // , onCellPrepared: function (e) {
            //         if (e.rowType === "data" && e.column.dataField === "hkstatusID_color") {
            //             const status = (e.value || "").toLowerCase();

            //             if (status.includes("dirty")) {
            //                 e.cellElement.css("background-color", "Red"); // d? nh?t
            //                   e.cellElement.css("color", "white");
            //             } else if (status.includes("pickup")) {
            //                 e.cellElement.css("background-color", "#f740f4"); // tím nh?t
            //             } else if (status.includes("clean non-checked")) {
            //                 e.cellElement.css("background-color", "#1bdff5"); // xanh nu?c bi?n nh?t
            //             } else if (status.includes("out of order")) {
            //                 e.cellElement.css("background-color", "#d1dfe3"); // h?ng
            //                   e.cellElement.css("color", "black");
            //             } else if (status.includes("clean")) {
            //                 e.cellElement.css("background-color", "green"); // xanh lá
            //                 e.cellElement.css("color", "white"); // ch? tr?ng cho d? nhìn
            //             }
            //         }
            //     },
        });
    }
       function initializeTurndownTasksheetGrid(data) {
        const columnWidth = 120;

        $("#logGridContainer").dxDataGrid({
            dataSource: data,
            allowColumnResizing: true,
            columnAutoWidth: true,
            height: 600,
            columns: [
                { dataField: "roomNo", caption: "RoomNo", width: columnWidth },
                { dataField: "hkStatusID", caption: "Room Status", width: columnWidth + 20 },
                { dataField: "foStatus", caption: "FOStatus", width: columnWidth },
                   {
                dataField: "attendant",
                caption: "Attendant",
                width: columnWidth,
                groupIndex: 0,
                visible: false,
                groupCellTemplate: function (cellElement, cellInfo) {
                    const groupAttendant = cellInfo.value;
                    const groupData = cellInfo.data.items || [];

                    if (groupData.length > 0) {
                        const firstItem = groupData[0];
                        const taskDate = firstItem.taskDate ? DevExpress.localization.formatDate(new Date(firstItem.taskDate), "dd/MM/yyyy") : "";
                        const taskSheetNo = firstItem.taskSheetNo || "";

                        // Tạo HTML nhiều dòng
                        const html = `
                            <div><strong>Task Date:</strong> ${taskDate}</div>
                            <div><strong>Attendant ID and Name:</strong> ${groupAttendant}</div>
                            <div><strong>Task Sheet No.:</strong> ${taskSheetNo}</div>
                        `;
                        cellElement.html(html);
                    } else {
                        cellElement.text(groupAttendant);
                    }
                }
            } ,
                { dataField: "credits", caption: "Credits", width: columnWidth, dataType: "number", format: "#,##0" },
                { dataField: "section", caption: "Section", width: columnWidth },
                { dataField: "status", caption: "Status", width: columnWidth },
                { dataField: "turndownStatus", caption: "Turndown Status", width: columnWidth + 30 },
                { dataField: "lastName", caption: "Name", width: columnWidth + 40 },
                { dataField: "arrivalDate", caption: "Arr.", width: columnWidth, dataType: "date", format: "dd/MM/yyyy" },
                { dataField: "arrivalTime", caption: "Arrival Time", width: columnWidth },
                { dataField: "departureDate", caption: "Dep.", width: columnWidth, dataType: "date", format: "dd/MM/yyyy" },
                { dataField: "vip", caption: "VIP", width: columnWidth },
                { dataField: "adult", caption: "A", width: columnWidth, dataType: "number", format: "#,##0" },
                { dataField: "child", caption: "C", width: columnWidth, dataType: "number", format: "#,##0" },
                { dataField: "specials", caption: "Specials", width: columnWidth },
                { dataField: "facilityTask", caption: "Facility Task", width: columnWidth },
            ],
            grouping: { autoExpandAll: true },
            groupPanel: { visible: false },
            paging: { pageSize: 25 },
            scrolling: { useNative: true, showScrollbar: "always" },
            pager: {
                visible: true,
                allowedPageSizes: [25, 50, 'all'],
                showPageSizeSelector: true,
                showInfo: true,
                showNavigationButtons: true
            },
            filterRow: { visible: true, applyFilter: "auto" },
            headerFilter: { visible: true },
            selection: { mode: "multiple", showCheckBoxesMode: "none" },
            showBorders: true,
            summary: {
                groupItems: [
                    { column: "roomNo", summaryType: "count", displayFormat: "Total Room :{0}", showInGroupFooter: true },
                    { column: "adult", summaryType: "sum", displayFormat: "{0}", showInGroupFooter: true },
                    { column: "child", summaryType: "sum", displayFormat: "{0}", showInGroupFooter: true },
                    { column: "credits", summaryType: "sum", displayFormat: "{0}", showInGroupFooter: true }
                ]
            }
        });
    }              let toggleSelectAll = false;
     $("#btnCheckAll").on("click", function () {
                const grid = $("#gridContainer").dxDataGrid("instance");

                if (!toggleSelectAll) {
                    grid.selectAll();   // chọn hết
                    toggleSelectAll = true;
                    $(this).html('<i class="fa-solid fa-xmark"></i> Uncheck All'); // đổi text/icon
                } else {
                    grid.deselectAll(); // bỏ chọn hết
                    toggleSelectAll = false;
                    $(this).html('<i class="fa-solid fa-check-double"></i> Check All');
                }
            });
           $(document).on("click", "#btnDailytasksheet", function () {
                     window.location.href = "/HouseKeeping/RoomAttendentDailyWorksheet";
           });


        $("#btnExportExcel").click(function () {
                   const grid = $("#gridContainer").dxDataGrid("instance");
            var selectedReport = 'Room Attendent Daily Worksheet';
            if (!selectedReport) {
                alert("Vui lòng ch?n báo cáo tru?c khi xu?t Excel.");
                return;
            }

                         const workbook = new ExcelJS.Workbook();const companyName = localStorage.getItem("CompanyName") || "Tên công ty chưa xác định";
            const worksheet = workbook.addWorksheet("Sheet 1");

            // === T?o header công ty (dòng 1) ===
            worksheet.addRow(['Công ty C? ph?n Gi?i pháp Công ngh? CS-Solution']);
            worksheet.mergeCells('A1:E1');
            worksheet.getRow(1).font = { bold: true };
            worksheet.getRow(1).alignment = { vertical: 'middle', horizontal: 'left' };

            // === Dòng 2: Th?i gian xu?t (ph?i) ===
            const now = new Date();
            const exportDate = now.toLocaleString("vi-VN");
            worksheet.addRow(['', '', '', '', ' ' + exportDate]);
            worksheet.mergeCells('E2:H2');
            worksheet.getRow(2).alignment = { vertical: 'middle', horizontal: 'right' };

            // === Dòng 3–4: Tr?ng
            worksheet.addRow([]);
            worksheet.addRow([]);

            // === Dòng 5: Tên báo cáo ? gi?a ===
            const reportRow = worksheet.addRow(['', '', selectedReport]);
            worksheet.mergeCells('C5:F5');
            reportRow.font = { bold: true, size: 14 };
            reportRow.alignment = { vertical: 'middle', horizontal: 'center' };

            // === Dòng 6: Tr?ng tru?c khi xu?t d? li?u
            worksheet.addRow([]);

            // === Export d? li?u t? DevExtreme (b?t d?u t? dòng 7)
            DevExpress.excelExporter.exportDataGrid({
                component: grid,
                worksheet: worksheet,
                autoFilterEnabled: true,
                topLeftCell: { row: 7, column: 1 } // d? li?u b?t d?u t? dòng 7
            }).then(function () {
                // Footer
                const lastRow = worksheet.lastRow.number + 2;
                worksheet.getCell(`A${lastRow}`).value = "--- END  ---";
                worksheet.mergeCells(`A${lastRow}:F${lastRow}`);
                worksheet.getCell(`A${lastRow}`).alignment = { horizontal: 'center' };
                worksheet.getCell(`A${lastRow}`).font = { italic: true };

                // Ghi file
                let fileName = selectedReport + ".xlsx";
                workbook.xlsx.writeBuffer().then(function (buffer) {
                    saveAs(new Blob([buffer], { type: "application/octet-stream" }), fileName);
                });
            });
        });
               $("#btnExportpopExcel").click(function () {
                   const grid = $("#logGridContainer").dxDataGrid("instance");
            var selectedReport = 'Turndown Tasksheet Report';
            if (!selectedReport) {
                alert("Vui lòng ch?n báo cáo tru?c khi xu?t Excel.");
                return;
            }

                         const workbook = new ExcelJS.Workbook();const companyName = localStorage.getItem("CompanyName") || "Tên công ty chưa xác định";
            const worksheet = workbook.addWorksheet("Sheet 1");

            // === T?o header công ty (dòng 1) ===
            worksheet.addRow(['Công ty C? ph?n Gi?i pháp Công ngh? CS-Solution']);
            worksheet.mergeCells('A1:E1');
            worksheet.getRow(1).font = { bold: true };
            worksheet.getRow(1).alignment = { vertical: 'middle', horizontal: 'left' };

            // === Dòng 2: Th?i gian xu?t (ph?i) ===
            const now = new Date();
            const exportDate = now.toLocaleString("vi-VN");
            worksheet.addRow(['', '', '', '', ' ' + exportDate]);
            worksheet.mergeCells('E2:H2');
            worksheet.getRow(2).alignment = { vertical: 'middle', horizontal: 'right' };

            // === Dòng 3–4: Tr?ng
            worksheet.addRow([]);
            worksheet.addRow([]);

            // === Dòng 5: Tên báo cáo ? gi?a ===
            const reportRow = worksheet.addRow(['', '', selectedReport]);
            worksheet.mergeCells('C5:F5');
            reportRow.font = { bold: true, size: 14 };
            reportRow.alignment = { vertical: 'middle', horizontal: 'center' };

            // === Dòng 6: Tr?ng tru?c khi xu?t d? li?u
            worksheet.addRow([]);

            // === Export d? li?u t? DevExtreme (b?t d?u t? dòng 7)
            DevExpress.excelExporter.exportDataGrid({
                component: grid,
                worksheet: worksheet,
                autoFilterEnabled: true,
                topLeftCell: { row: 7, column: 1 } // d? li?u b?t d?u t? dòng 7
            }).then(function () {
                // Footer
                const lastRow = worksheet.lastRow.number + 2;
                worksheet.getCell(`A${lastRow}`).value = "--- END  ---";
                worksheet.mergeCells(`A${lastRow}:F${lastRow}`);
                worksheet.getCell(`A${lastRow}`).alignment = { horizontal: 'center' };
                worksheet.getCell(`A${lastRow}`).font = { italic: true };

                // Ghi file
                let fileName = selectedReport + ".xlsx";
                workbook.xlsx.writeBuffer().then(function (buffer) {
                    saveAs(new Blob([buffer], { type: "application/octet-stream" }), fileName);
                });
            });
        });
</script>