<div class="modal fade modal-xl" id="modalCheckOutAll" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Check Out </h5>
                <button type="button" class="btn-close" onclick="closeModalCheckOutAll()"></button>
            </div>
            <div class="modal-body">
                <div style="display:flex;column-gap:12px">
                    <button class="submit-button-clear-reservation" onclick="processCheckOutAll()">Process</button>

                    <button class="submit-button-new-reservation" onclick="closeModalCheckOutAll()">Close</button>

                </div>
                <div id="gridContainerCheckOutAll" class="gridContainer mt-2"></div>

            </div>
        </div>
    </div>
</div>
<script>
    function openModalCheckOutAll(type) {
        if (reservationStatus != 1 && reservationStatus != 6) {
            showToast('Error', "Please just choose booking has status CHECKED IN or DUE OUT", false);
            return;
        }

        var grid = $("#gridContainer").dxDataGrid("instance");
        var dataSource = grid.getDataSource();
        var allData = dataSource.items();

        // Filter data based on type
        var filteredData = allData;
        if (type == 2) {
            filteredData = allData.filter(function(item) {
                return item.ReservationStatus == 6;
            });
        }

        // Map the filtered data
        filteredData = filteredData.map(function(item) {
            return {
                roomNo: item.RoomNo,
                mg: item.MG,
                id: item.ID,
                name: item.GuestName,
                reservationStatus: item.ReservationStatus,
                coStatus: "",
                message: ""
            };
        });

        initializeDataGridCheckOutAll(filteredData);
        $('#modalCheckOutAll').modal('show');
    }
    function processCheckOutAll(){
        var grid = $("#gridContainerCheckOutAll").dxDataGrid("instance");
        const userName = JSON.parse(localStorage.getItem("Loginname"));
        const userID = JSON.parse(localStorage.getItem("userID"));
        var dataSource = grid.getDataSource();
        var filteredData = dataSource.items();

        $.ajax({
            url: '/Reservation/CheckOutAll',
            type: 'POST',

            // headers: { "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val() },
            data: {
                listItem: filteredData,
                userID: userID,
                userName: userName
            },
            success: function (data) {
                if (data.code == 0) {
                    initializeDataGridCheckOutAll(data.data);
                    $('#searchType').val(1);
                    searchReservation();
                    showToast('Success', data.msg, true);
                } else {
                    showToast('Error', data.msg, false);
                }

            },
            error: function (xhr, statusText, err) {

            }
        });
    }
    function closeModalCheckOutAll(){
        $('#modalCheckOutAll').modal('hide');

    }
    function initializeDataGridCheckOutAll(data) {
        // Kiểm tra dữ liệu đầu vào

        // Nếu cần giới hạn tổng số bản ghi, ví dụ 100 bản ghi
        const limitedData = data.slice(0, 100);

        $("#gridContainerCheckOutAll").dxDataGrid({
            dataSource: limitedData, // Sử dụng dữ liệu đã giới hạn
            allowColumnResizing: true,
            columnAutoWidth: true,
            columnMinWidth: 90,
            paging: {
                enabled: true, // Bật phân trang
                pageSize: 15 // Mỗi trang 15 bản ghi
            },
            pager: {
                visible: true,
                allowedPageSizes: [15, 20, 30], // Chỉ các kích thước trang cố định
                showPageSizeSelector: true,
                showInfo: true, // Hiển thị thông tin phân trang
                showNavigationButtons: true
            },
            scrolling: {
                mode: 'standard', // Thay 'virtual' bằng 'standard' để kiểm tra
                showScrollbar: 'always',
                useNative: false
            },
            filterRow: {
                visible: true,
                applyFilter: "auto"
            },
            selection: {
                mode: "single"
            },
            columns: [
                { dataField: "roomNo", caption: "Room No" },
                { dataField: "mg", caption: "MG" },
                { dataField: "id", visible: false }, // Ẩn cột ID
                { dataField: "name", caption: "Guest Name" },
                { dataField: "reservationStatus", visible: false }, // Ẩn cột ReservationStatus
                { dataField: "coStatus", caption: "CO Status" },
                { dataField: "message", caption: "Message" }
            ]
        });
    }
    function openModalCheckOut(){
        if(idReservation == 0){
            showToast('Error', "Please choose booking", false);
            return;
        }
        if(reservationStatus != 6){
            showToast('Error', "Please choose booking has status DUE OUT", false);
            return;
        }
        const userName = JSON.parse(localStorage.getItem("Loginname"));
        const userID = JSON.parse(localStorage.getItem("userID"));
        $.ajax({
            url: '/Reservation/CheckOut',
            type: 'POST',

            // headers: { "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val() },
            data: {
                userID: userID,
                userName: userName,
                reservationID: idReservation
            },
            success: function (data) {
                if (data.code == 0) {
                    $('#searchType').val(1);
                    searchReservation();
                    showToast('Success', data.msg, true);
                } else {
                    showToast('Error', data.msg, false);
                }

            },
            error: function (xhr, statusText, err) {

            }
        });
    }
</script>