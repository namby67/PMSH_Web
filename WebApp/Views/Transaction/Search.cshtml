<style>
    .header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 5px 0px;
        border-bottom: 2px solid #ececec;
    }

        .header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #000000;
        }

        .header .info-icon {
            color: #6b7280;
            cursor: pointer;
            transition: color 0.3s ease;
        }

            .header .info-icon:hover {
                color: var(--main-color);
            }
</style>
<div>
    <div class="header mt-2" style="border-bottom:none;justify-content:center">
        <h3 id="content-title">
            Transaction Search
        </h3>
    </div>
    <div class="mb-2">
        <button class="mui-button mui-button-search" onclick="SearchTransaction();"> Search</button>
        <button class="mui-button mui-button-new" onclick="openModalNew();"> New</button>

    </div>
    <div class="row">
        <div class="col-md-2 row">
            <label class="col-md-4">Grp. Code</label>
            <select class="col-md-8" type="text" id="groupCode">

            </select>
        </div>
        <div class="col-md-2 row">
            <label class="col-md-4">Sub Grp. Code</label>
            <select class="col-md-8" type="text" id="groupSubCode">
            </select>
        </div>
        <div class="col-md-2">
            <label>Code</label>
            <input type="text" id="code">
        </div>
        <div class="col-md-6">
            <label>Description</label>
            <input type="text" id="description">
        </div>

    </div>
    <div class="mui-card mt-2">
        <div id="gridContainer" class="gridContainer mt-2"></div>
    </div>
</div>


<script>

    function SearchTransaction() {

        $.ajax({
            url: '/Transaction/SearchTransaction',
            type: 'get',
            dataType: 'json',
            data: {
                groupCode: $('#code').val(),
                description: $('#description').val()
            },
            crossDomain: false,
            headers: { "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val() },
            success: function (result) {
                initializeDataGridSearch(result);
            },
            error: function (xhr, statusText, err) {
                if (xhr.status == 401) {
                    sessionTimeout();
                }
            },

        });

    }
    function initializeDataGridSearch(data) {
        const limitedData = data.slice(0, 100);

        $("#gridContainer").dxDataGrid({
            dataSource: limitedData,
            allowColumnResizing: true,
            columnMinWidth: 90,
            paging: {
                enabled: true, // Enable paging
                pageSize: 15 // 15 records per page
            },
            pager: {
                visible: true,
                allowedPageSizes: [15, 20, 30], // Fixed page sizes
                showPageSizeSelector: true,
                showInfo: true, // Show paging info
                showNavigationButtons: true
            },
            scrolling: {
                mode: 'standard', // Standard scrolling mode
                showScrollbar: 'always',
                useNative: false
            },
            filterRow: {
                visible: true,
                applyFilter: "auto"
            },
            selection: {
                mode: "multiple", // Enable multiple row selection
                showCheckBoxesMode: "always" // Always show checkboxes
            },
            columns: [
                { dataField: "ID", caption: "ID",visible: false },

                { dataField: "GroupCode", caption: "Group Code" },
                { dataField: "SubgroupCode", caption: "Sub Group Code" },
                { dataField: "Code", caption: "Code" },
                { dataField: "Description", caption: "Description" },
                { dataField: "DefaultPrice", caption: "Default Price" },
                { dataField: "CurrencyID", caption: "Cur" },
                { dataField: "AdjustmentCode", caption: "Adj.Code" },
                { dataField: "TransactionTypeName", caption: "Transaction Type" },
                { 
                    dataField: "RevenueGroup", 
                    caption: "Revenue Group" ,
                    dataType: "boolean", // Định dạng dữ liệu là boolean
                    cellTemplate: function (container, options) {
                        // Tùy chỉnh hiển thị checkbox
                        const isChecked = options.value === "True" || options.value === true;
                        $("<input>")
                            .attr("type", "checkbox")
                            .prop("checked", isChecked)
                            .css({
                                "width": "15px", // Kích thước checkbox
                                "height": "15px",

                            })
                            .appendTo(container);
                    }
                },
                { 
                    dataField: "ManualPosting", 
                    caption: "Manual Posting",
                    dataType: "boolean", // Định dạng dữ liệu là boolean
                    cellTemplate: function (container, options) {
                        // Tùy chỉnh hiển thị checkbox
                        const isChecked = options.value === "True" || options.value === true;
                        $("<input>")
                            .attr("type", "checkbox")
                            .prop("checked", isChecked)
                            .css({
                                "width": "15px", // Kích thước checkbox
                                "height": "15px",

                            })
                            .appendTo(container);
                    }
                },
                { 
                    dataField: "TaxInclude", 
                    caption: "Tax Include" ,
                    dataType: "boolean", // Định dạng dữ liệu là boolean
                    cellTemplate: function (container, options) {
                        // Tùy chỉnh hiển thị checkbox
                        const isChecked = options.value === "True" || options.value === true;
                        $("<input>")
                            .attr("type", "checkbox")
                            .prop("checked", isChecked)
                            .css({
                                "width": "15px", // Kích thước checkbox
                                "height": "15px",

                            })
                            .appendTo(container);
                    }
                },
                { 
                    dataField: "FOPayments", 
                    caption: "FO Payments" ,
                    dataType: "boolean", // Định dạng dữ liệu là boolean
                    cellTemplate: function (container, options) {
                        // Tùy chỉnh hiển thị checkbox
                        const isChecked = options.value === "True" || options.value === true;
                        $("<input>")
                            .attr("type", "checkbox")
                            .prop("checked", isChecked)
                            .css({
                                "width": "15px", // Kích thước checkbox
                                "height": "15px",

                            })
                            .appendTo(container);
                    }
                },
                { 
                    dataField: "ARPayments",
                    caption: "AR Payments",
                    dataType: "boolean", // Định dạng dữ liệu là boolean
                    cellTemplate: function (container, options) {
                        // Tùy chỉnh hiển thị checkbox
                        const isChecked = options.value === "True" || options.value === true;
                        $("<input>")
                            .attr("type", "checkbox")
                            .prop("checked", isChecked)
                            .css({
                                "width": "15px", // Kích thước checkbox
                                "height": "15px",

                            })
                            .appendTo(container);
                    }
                },
                { 
                    dataField: "DepositPayments",
                    caption: "Deposit Payments" ,
                    dataType: "boolean", // Định dạng dữ liệu là boolean
                    cellTemplate: function (container, options) {
                        // Tùy chỉnh hiển thị checkbox
                        const isChecked = options.value === "True" || options.value === true;
                        $("<input>")
                            .attr("type", "checkbox")
                            .prop("checked", isChecked)
                            .css({
                                "width": "15px", // Kích thước checkbox
                                "height": "15px",

                            })
                            .appendTo(container);
                    }
                },
                { 
                    dataField: "Paidout",
                    caption: "Paid out",
                    dataType: "boolean", // Định dạng dữ liệu là boolean
                    cellTemplate: function (container, options) {
                        // Tùy chỉnh hiển thị checkbox
                        const isChecked = options.value === "True" || options.value === true;
                        $("<input>")
                            .attr("type", "checkbox")
                            .prop("checked", isChecked)
                            .css({
                                "width": "15px", // Kích thước checkbox
                                "height": "15px",

                            })
                            .appendTo(container);
                    }
                },
                {
                    dataField: "IsActive",
                    caption: "Hoạt Động",
                    dataType: "boolean", // Định dạng dữ liệu là boolean
                    cellTemplate: function (container, options) {
                        // Tùy chỉnh hiển thị checkbox
                        const isChecked = options.value === "True" || options.value === true;
                        $("<input>")
                            .attr("type", "checkbox")
                            .prop("checked", isChecked)
                            .css({
                                "width": "15px", // Kích thước checkbox
                                "height": "15px",
    
                            })
                            .appendTo(container);
                    }
                } ,
                { dataField: "PaymentTypeName", caption: "Payment Type" },

            ],
            onRowClick: function(e) {
                const grid = $("#gridContainer").dxDataGrid("instance");
                grid.selectRows([e.key], false);
                templateID = e.data.id;
            },
        });
    }
    $(document).ready(function() {

        getInforServices();
    });
    function getInforServices(){
        $.ajax({
            url: '/Billing/GetInforService',
            type: 'get',
            dataType: 'json',
            crossDomain: false,
            headers: { "X-CSRF-TOKEN-HEADERNAME": jQuery("input[name='__RequestVerificationToken']").val() },
            success: function (result) {
                $('#groupCode').empty();
                $('#groupCode').append($('<option>', { value: '0', text: '--Select--' }));
                if(result.groupTransaction.length > 0){

                    $.each(result.groupTransaction, function (i, item) {
                        $('#groupCode').append($('<option>', { value: item.id, text: item.description }));
                    });
                }
                $('#groupSubCode').empty();
                $('#groupSubCode').append($('<option>', { value: '0', text: '--Select--' }));
                if(result.groupSubTransaction.length > 0){

                    $.each(result.groupSubTransaction, function (i, item) {
                        $('#groupSubCode').append($('<option>', { value: item.id, text: item.description }));
                    });
                }
                SearchTransaction();
            },
            error: function (xhr, statusText, err) {
                if (xhr.status == 401) {
                    sessionTimeout();
                } else {
                }
            }
        });
    }

</script>